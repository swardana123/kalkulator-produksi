<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Kalkulator Produksi Lengkap</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(to bottom right, #e3f2fd, #ffffff); margin:0; padding:10px; color:#333; }
        .header { display:flex; flex-direction:column; gap:10px; align-items:center; margin-bottom:20px; }
        .header h1 { font-size:1.5rem; text-align:center; margin-top: 0; margin-bottom: 5px; }
        /* General style for select in header, specific selects might override this */
        .header select { padding:8px; font-size:1rem; border-radius:6px; border:1px solid #ccc; width: auto; max-width: 200px; }

        .tab-container { display:flex; flex-wrap: wrap; margin-bottom:10px; border-radius:8px; overflow:hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab { flex:1; min-width: 120px; /* Adjusted for more tabs */ padding:10px; background-color:#eee; text-align:center; cursor:pointer; transition:background-color .3s; font-size:.85rem; /* Adjusted for more tabs */ border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;}
        .tab:last-child { border-right: none; }
        .tab.active { background-color:#2196F3; color:white; font-weight:bold; border-bottom-color: #2196F3; }
        .content { display:none; background:white; padding:15px; border-radius:0 0 8px 8px; box-shadow:0 2px 10px rgba(0,0,0,.1); animation: fadeIn 0.5s; margin-top:-1px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .content.active { display:block; }

        /* General input/select/button styles for tabs */
        .content input, .content select, .content button {
            width:100%; max-width:400px; padding:10px; margin:8px 0; font-size:1rem;
            border-radius:8px; border:1px solid #ccc; box-sizing:border-box;
        }
        .content button { background-color:#2196F3; color:white; border:none; cursor:pointer; transition: background-color 0.3s; }
        .content button:hover { background-color:#1976D2; }

        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9rem; color: #555;}
        .hasil { margin-top:10px; padding: 10px; background-color: #e8f5e9; border-left: 5px solid #4CAF50; font-weight:bold; color:#2E7D32; border-radius: 4px; }
        .hidden { display:none !important; }
        input[readonly] { background-color: #e9ecef; color: #495057; cursor: not-allowed; }
        h2 { margin-top: 0; color: #1976D2; }

        /* Notifikasi Popup */
        .notifikasi-popup { position: fixed; bottom: 20px; right: 20px; padding: 15px 20px; background-color: #4CAF50; color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 15px; transition: opacity 0.5s, transform 0.5s; opacity: 0; transform: translateY(100px); pointer-events: none; }
        .notifikasi-popup.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .notifikasi-popup button { background-color: white; color: #4CAF50; border: 1px solid #4CAF50; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; max-width: 100px; margin: 0; width: auto; }

        /* Styles specific to Kalkulator Komposisi Bahan in Tab 5 */
        #tab-5 .comp-calculator-container h1, #tab-5 .comp-calculator-container h2, #tab-5 .comp-calculator-container h3 { color: #2c3e50; text-align: center; }
        #tab-5 .comp-calculator-container h2 { margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        #tab-5 .comp-calculator-container h3 { margin-top: 0; color: #34495e; }
        #tab-5 .comp-calculator-container label { display: block; margin-top: 12px; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 0.9rem; }

        #tab-5 .comp-calculator-container input[type="text"],
        #tab-5 .comp-calculator-container input[type="number"],
        #tab-5 .comp-calculator-container select {
            width: calc(100% - 22px); /* Original calculator style */
            max-width: none; /* Override max-width from general .content style */
            padding: 10px;
            margin-bottom: 10px; /* Original calculator style */
            margin-top: 0; /* Override general margin */
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px; /* Calculator used 16px, main uses 1rem. Typically same. */
            background-color: #fff;
        }
        #tab-5 .comp-calculator-container button {
            background-color: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 15px; /* Original calculator style */
            margin-bottom: 0; /* Override general margin */
            max-width: none; /* Override max-width from general .content style */
        }
        #tab-5 .comp-calculator-container button:hover { background-color: #2980b9; }
        #tab-5 .comp-calculator-container button.add-ingredient-btn { background-color: #2ecc71; margin-top: 20px; margin-bottom: 10px; }
        #tab-5 .comp-calculator-container button.add-ingredient-btn:hover { background-color: #27ae60; }
        #tab-5 .comp-calculator-container textarea {
            width: calc(100% - 22px);
            max-width: none; /* Override max-width */
            padding: 10px;
            margin-top: 15px;  /* Original calculator style */
            margin-bottom: 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
            min-height: 100px;
        }
        #tab-5 .comp-calculator-container .result-text { font-weight: bold; color: #27ae60; }
        #tab-5 .comp-calculator-container .input-group { margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; background-color: #f9f9f9; }
        #tab-5 .comp-calculator-container .overall-inputs { background-color: #e8f4fd; padding: 20px; border-radius: 5px; margin-bottom: 25px; }
        /* End of styles specific to Kalkulator Komposisi Bahan */
    </style>
</head>
<body>
    <div class="header">
        <select id="language" onchange="ubahBahasa()">
            <option value="id">Bahasa Indonesia</option>
            <option value="en">English</option>
            <option value="zh">中文 (普通话)</option>
        </select>
        <h1 id="judulHalaman">Gabungan Kalkulator Produksi</h1>
    </div>

    <div class="tab-container">
        <div class="tab active" onclick="showTab(0)" id="tab0">Hitung Waktu Produksi</div>
        <div class="tab" onclick="showTab(1)" id="tab1">Waktu Angkat FG</div>
        <div class="tab" onclick="showTab(2)" id="tab2">Air Recycle</div>
        <div class="tab" onclick="showTab(3)" id="tab3">Flowrate Baru</div>
        <div class="tab" onclick="showTab(4)" id="tab4">Flowrate Headbox</div>
        <div class="tab" onclick="showTab(5)" id="tab5">Komposisi Bahan</div> </div>

    <div id="tab-0" class="content active">
        <h2 id="judul0">Hitung Waktu Produksi</h2>
        <label for="targetProduksi" id="lblTargetProduksi">Target Produksi (cth: 1500)</label>
        <input id="targetProduksi" type="number" />
        <label for="beratBobbin" id="lblBeratBobbin">Berat Bobbin (kg, cth: 15)</label>
        <input id="beratBobbin" type="number" />
        <label for="jumlahPotongan" id="lblJumlahPotongan">Potongan/Bobbin (cth: 10)</label>
        <input id="jumlahPotongan" type="number" />
        <label for="waktuPengangkatan" id="lblWaktuPengangkatan">Waktu Angkat/Bobbin (menit)</label>
        <input id="waktuPengangkatan" type="number" />
        <label for="tanggalMulai" id="lblTanggalMulai">Tanggal Mulai</label>
        <input id="tanggalMulai" type="date" />
        <label for="jamMulai" id="lblJamMulai">Jam Mulai (misal: 08:00)</label>
        <input id="jamMulai" type="time" />
        <button onclick="hitungWaktuPengangkatan()" id="btnPengangkatan">Hitung Waktu Selesai</button>
        <div class="hasil" id="hasilPengangkatan">Waktu Selesai Produksi: </div>
    </div>

    <div id="tab-1" class="content">
        <h2 id="judul1">Perhitungan Waktu Angkat Finish Good</h2>
        <label for="berat" id="lblBerat">Berat Roll (kg), cth: 16</label>
        <input id="berat" type="number" />
        <label for="bahan" id="lblBahan">Pilih Bahan</label>
        <select id="bahan" onchange="aturGSMdanPisau()">
            <option id="optBahan0" value="">Pilih Bahan</option>
            <option id="optBahan1" value="Bouyan">Bouyan</option>
            <option id="optBahan2" value="BAT">BAT</option>
            <option id="optBahan3" value="Highlander">Highlander</option>
        </select>
        <label for="gsm" id="lblGsm" class="hidden">GSM (otomatis)</label>
        <input class="hidden" id="gsm" type="number" readonly/>
        <label for="pisau" id="lblPisau" class="hidden">Pisau (otomatis)</label>
        <input class="hidden" id="pisau" type="number" readonly/>
        <label for="speed" id="lblSpeed">Kecepatan Belting (m/detik, cth: 10.20)</label>
        <input id="speed" type="number" />
        <button onclick="hitungWaktuAngkat()" id="btnHitung">Hitung Durasi Angkat</button>
        <div class="hasil" id="hasilWaktuAngkat">Durasi Angkat: </div>
    </div>

    <div id="tab-2" class="content">
        <h2 id="judul2">Perhitungan Air Recycle</h2>
        <label for="jumlahRecycle" id="lblJumlahRecycle">Jumlah Recycle (kg, cth:60)</label>
        <input id="jumlahRecycle" type="number" />
        <label for="moisture" id="lblMoisture">Moisture (fraksi, cth:0.93)</label>
        <input id="moisture" type="number" step="any" />
        <label for="konsentrasi" id="lblKonsentrasi">Konsentrasi (fraksi, cth:0.16)</label>
        <input id="konsentrasi" type="number" step="any" />
        <button onclick="hitungAirRecycle()" id="btnAir">Hitung Air Recycle</button>
        <div class="hasil" id="hasilAirRecycle">Jumlah Air yang Diperlukan: </div>
    </div>

    <div id="tab-3" class="content">
        <h2 id="judul3">Flowrate Baru</h2>
        <label for="flowAwal" id="lblFlowAwal">Flow rate awal (L/jam, cth:100)</label>
        <input id="flowAwal" type="number" step="any" />
        <label for="kecepatanAwal" id="lblKecepatanAwal">Kecepatan belting awal (m/detik)</label>
        <input id="kecepatanAwal" type="number" step="any" />
        <label for="kecepatanBaru" id="lblKecepatanBaru">Kecepatan belting baru (m/detik)</label>
        <input id="kecepatanBaru" type="number" step="any" />
        <button onclick="hitungFlowrateBaru()" id="btnFlowrate">Hitung Flowrate Baru</button>
        <div class="hasil" id="hasilFlowrate">Laju Aliran Disarankan: </div>
    </div>

    <div id="tab-4" class="content">
        <h2 id="judul4">Mencari Flow rate Headbox</h2>
        <label for="bahanHeadbox" id="lblBahanHeadbox">Pilih Material:</label>
        <select id="bahanHeadbox" onchange="aturInputHeadbox()">
            <option id="optBahanHeadbox0" value="">Pilih Material</option>
            <option id="optBahanHeadboxBouyan" value="Bouyan">Bouyan</option>
            <option id="optBahanHeadboxCustom" value="Custom">Custom</option>
        </select>
        <label for="gsmFormula" id="lblGsmFormulaHeadbox">GSM:</label>
        <input id="gsmFormula" type="number" step="any"/>
        <label for="kecepatanBeltingFormula" id="lblKecepatanBeltingFormulaHeadbox">Kecepatan Belting (m/detik):</label>
        <input id="kecepatanBeltingFormula" type="number" step="any"/>
        <label for="lebarKertasFormula" id="lblLebarKertasFormulaHeadbox">Lebar Kertas (meter):</label>
        <input id="lebarKertasFormula" type="number" step="any"/>
        <label for="pulpConcentrationFormula" id="lblPulpConcentrationFormulaHeadbox">Konsentrasi Pulp (fraksi):</label>
        <input id="pulpConcentrationFormula" type="number" step="any"/>
        <button onclick="hitungFormulaHeadbox()" id="btnFormulaZatPadat">Hitung Flowrate Headbox</button>
        <div class="hasil" id="hasilFormulaZatPadat">Flowrate Headbox: </div>
    </div>

    <div id="tab-5" class="content">
        <div class="comp-calculator-container"> <h2 id="judul5">Kalkulator Komposisi Bahan Dinamis</h2>

            <div class="overall-inputs">
                <label for="compProductName" id="lblCompProductName">Nama Produk Jadi:</label>
                <select id="compProductName">
                    <option value="" id="optCompProd0">Pilih Produk...</option>
                    <option value="PTWCJ-HTBH-5C">PTWCJ-HTBH-5C</option>
                    <option value="PTWCJ-HTBLM-2(2)">PTWCJ-HTBLM-2(2)</option>
                    <option value="PTWCJ-HTNY-7">PTWCJ-HTNY-7</option>
                    <option value="PTWCJ-HTHH-3C(3)">PTWCJ-HTHH-3C(3)</option>
                    <option value="PTWCJ-HTMJT-3">PTWCJ-HTMJT-3</option>
                    <option value="PTWCJ-HTBH-6A(2)">PTWCJ-HTBH-6A(2)</option>
                    <option value="PTWCJ-HTXG-6">PTWCJ-HTXG-6</option>
                    <option value="PTWCJ-HTBH-6-1">PTWCJ-HTBH-6-1</option>
                    <option value="PTWCJ-HTKY-11">PTWCJ-HTKY-11</option>
                    <option value="PTWCJ-HTHH-4">PTWCJ-HTHH-4</option>
                    <option value="PTWCJ-HTCH-10">PTWCJ-HTCH-10</option>
                    <option value="PTWCJ-HTNM-6">PTWCJ-HTNM-6</option>
                    <option value="PTWCJ-HTKF-9">PTWCJ-HTKF-9</option>
                    <option value="PTWCJ-HTHMG-1">PTWCJ-HTHMG-1</option>
                    <option value="PTWCJ-HTYW-1">PTWCJ-HTYW-1</option>
                    <option value="PTWCJ-HTHHXJ-1">PTWCJ-HTHHXJ-1</option>
                    <option value="PTWCJ-HTNY-11">PTWCJ-HTNY-11</option>
                    <option value="PTWCJ-HTLMJ-1">PTWCJ-HTLMJ-1</option>
                    <option value="PTWCJ-HTBMG-4">PTWCJ-HTBMG-4</option>
                    <option value="PTWCJ-HTRW">PTWCJ-HTRW</option>
                    <option value="PTWCJ-HTKT">PTWCJ-HTKT</option>
                    <option value="PTWCJ-HTBML">PTWCJ-HTBML</option>
                </select>

                <label for="compBaseRecycleAmount" id="lblCompBaseRecycleAmount">Berat Acuan Recycle (kg):</label>
                <input type="number" id="compBaseRecycleAmount" step="any">

                <label for="compTargetRecycleAmount" id="lblCompTargetRecycleAmount">Target Produksi Recycle (kg):</label>
                <input type="number" id="compTargetRecycleAmount" step="any">
            </div>

            <h3 id="compDetailBahanTitle">Detail Bahan</h3>
            <div id="compIngredientSectionsContainer">
                <div class="input-group" data-ingredient-id="1">
                    <h3 id="compBahan1Title">Bahan 1</h3>
                    <label for="compIngredientName1" id="lblCompIngredientName1">Nama Bahan 1:</label>
                    <input type="text" id="compIngredientName1" class="comp-ingredient-name-input">

                    <label for="compIngredientRatio1" id="lblCompIngredientRatio1">Rasio Bhn 1 (dlm Berat Acuan):</label>
                    <input type="number" id="compIngredientRatio1" class="comp-ingredient-ratio-input" step="any">

                    <p><span id="txtCompKebutuhan">Kebutuhan</span> <span class="compIngredientNameDisplay" id="compIngredientNameDisplay1">Bahan 1</span>: <span class="result-text comp-ingredient-result" id="compIngredientResult1">0.00</span> kg</p>
                </div>
            </div>

            <button onclick="addCompIngredientColumn()" class="add-ingredient-btn" id="btnCompTambahBahan">Tambah Kolom Bahan</button>
            <button onclick="calculateCompAll()" id="btnCompHitungSemua">Hitung Semua</button>

            <h3 id="compRingkasanTitle">Ringkasan untuk Disalin</h3>
            <textarea id="compSummaryForCopy" rows="8" readonly></textarea>
            <button onclick="copyCompSummary()" id="btnCompSalinRingkasan">Salin Ringkasan</button>
        </div>
    </div>
    <div id="notifikasiSelesaiPopup" class="notifikasi-popup">
        <span id="teksNotifikasiSelesai"></span>
        <button id="btnTutupNotifikasi" onclick="tutupNotifikasiSelesai()">Tutup</button>
    </div>

<script>
    // Variabel global untuk notifikasi
    let targetWaktuSelesaiNotifikasi = null;
    let intervalCekWaktuNotifikasi = null;
    let notifikasiSudahDitampilkan = false;

    const teks = {
        id:{
            judulHalaman:"Gabungan Kalkulator Produksi",
            tab0:"Hitung Waktu Produksi",tab1:"Waktu Angkat FG",tab2:"Air Recycle",tab3:"Flowrate Baru", tab4:"Flowrate Headbox", tab5:"Komposisi Bahan", // Teks Tab Baru
            judul0:"Hitung Waktu Produksi",judul1:"Perhitungan Waktu Angkat Finish Good",judul2:"Perhitungan Air Recycle",judul3:"Flowrate Baru", judul4:"Mencari Flow rate Headbox", judul5:"Kalkulator Komposisi Bahan Dinamis", // Judul Konten Tab Baru
            btnPengangkatan:"Hitung Waktu Selesai",hasilPengangkatan:"Waktu Selesai Produksi: ",alert:"Mohon lengkapi semua data yang diperlukan dengan benar.",
            btnHitung:"Hitung Durasi Angkat",hasilWaktuAngkat:"Durasi Angkat: ",
            btnAir:"Hitung Air Recycle",hasilAirRecycle:"Jumlah Air yang Diperlukan: ",
            btnFlowrate:"Hitung Flowrate Baru",hasilFlowrate:"Laju Aliran Disarankan: ",
            btnFormulaZatPadat:"Hitung Flowrate Headbox", hasilFormulaZatPadat:"Flowrate Headbox: ",
            optBahan0:"Pilih Bahan",
            optBahanHeadbox0: "Pilih Material", optBahanHeadboxBouyan: "Bouyan", optBahanHeadboxCustom: "Kustom",
            lblBahanHeadbox: "Pilih Material:", lblGsmFormulaHeadbox: "GSM:", lblKecepatanBeltingFormulaHeadbox: "Kecepatan Belting (m/detik):", lblLebarKertasFormulaHeadbox: "Lebar Kertas (meter):", lblPulpConcentrationFormulaHeadbox: "Konsentrasi Pulp (fraksi):",
            notifikasi: { pesan: "Waktu produksi yang dihitung telah tercapai!", tutupButton: "Tutup" },
            // Label untuk input fields
            lblTargetProduksi:"Target Produksi (cth: 1500)", lblBeratBobbin:"Berat Bobbin (kg, cth: 15)", lblJumlahPotongan:"Potongan/Bobbin (cth: 10)", lblWaktuPengangkatan:"Waktu Angkat/Bobbin (menit)", lblTanggalMulai:"Tanggal Mulai", lblJamMulai:"Jam Mulai (misal: 08:00)",
            lblBerat:"Berat Roll (kg), cth: 16", lblBahan:"Pilih Bahan", lblGsm:"GSM (otomatis)", lblPisau:"Pisau (otomatis)", lblSpeed:"Kecepatan Belting (m/detik, cth: 10.20)",
            lblJumlahRecycle:"Jumlah Recycle (kg, cth:60)", lblMoisture:"Moisture (fraksi, cth:0.93)", lblKonsentrasi:"Konsentrasi (fraksi, cth:0.16)",
            lblFlowAwal:"Flow rate awal (L/jam, cth:100)", lblKecepatanAwal:"Kecepatan belting awal (m/detik)", lblKecepatanBaru:"Kecepatan belting baru (m/detik)",
            // Teks untuk Kalkulator Komposisi Bahan (Tab 5)
            comp: {
                lblCompProductName: "Nama Produk Jadi:", optCompProd0: "Pilih Produk...", lblCompBaseRecycleAmount: "Berat Acuan Recycle (kg):", lblCompTargetRecycleAmount: "Target Produksi Recycle (kg):",
                compDetailBahanTitle: "Detail Bahan", compBahanTitle: "Bahan", lblCompIngredientName: "Nama Bahan", lblCompIngredientRatio: "Rasio Bhn (dlm Berat Acuan):",
                txtCompKebutuhan: "Kebutuhan", btnCompTambahBahan: "Tambah Kolom Bahan", btnCompHitungSemua: "Hitung Semua",
                compRingkasanTitle: "Ringkasan untuk Disalin", btnCompSalinRingkasan: "Salin Ringkasan",
                alertCopied: "Ringkasan telah disalin ke clipboard!", alertCopyFailed: "Gagal menyalin. Browser Anda mungkin tidak mendukung fitur ini atau memerlukan izin.",
                alertNothingToCopy: "Tidak ada hasil perhitungan yang signifikan untuk disalin.",
                defaultProductName: "Produk Tanpa Nama",
                placeholderBaseRecycle: "Contoh: 18.75", placeholderTargetRecycle: "Contoh: 30",
                placeholderIngredientName: "Nama Bahan", placeholderIngredientRatio: "Mis: 0.19",
                placeholderSummary: "Hasil perhitungan akan muncul di sini..."
            },
            placeholders:{ // Original placeholders, review if these are still used as labels are now separate
                targetProduksi:"Target Produksi (cth: 1500)",beratBobbin:"Berat Bobbin (kg, cth: 15)", jumlahPotongan:"Potongan/Bobbin (cth: 10)",waktuPengangkatan:"Waktu Angkat/Bobbin (menit)", tanggalMulai:"Tanggal Mulai",jamMulai:"Jam Mulai (misal: 08:00)",
                berat:"Berat Roll (kg), cth: 16", gsm:"GSM (otomatis)", pisau:"Pisau (otomatis)", speed:"Kecepatan Belting (m/detik, cth: 10.20)",
                jumlahRecycle:"Jumlah Recycle (kg, cth:60)",moisture:"Moisture (fraksi, cth:0.93)", konsentrasi:"Konsentrasi (fraksi, cth:0.16)",
                flowAwal:"Flow rate awal (L/jam, cth:100)",kecepatanAwal:"Kecepatan belting awal (m/detik)", kecepatanBaru:"Kecepatan belting baru (m/detik)",
                gsmFormula: "Input GSM (cth: 0.22)", kecepatanBeltingFormula: "Input Kecepatan (cth: 10.0)", lebarKertasFormula: "Input Lebar (cth: 1.30)", pulpConcentrationFormula: "cth: 0.17"
            }
        },
        en:{
            judulHalaman:"Combined Production Calculator",
            tab0:"Production Time",tab1:"FG Lifting Time",tab2:"Water Recycle",tab3:"New Flowrate", tab4:"Headbox Flowrate", tab5:"Material Composition", // New Tab Text
            judul0:"Production Time Calculation",judul1:"Finish Good Lifting Time Calculation",judul2:"Water Recycle Calculation",judul3:"New Flowrate Calculation", judul4:"Headbox Flowrate Calculation", judul5:"Dynamic Material Composition Calculator", // New Tab Content Title
            btnPengangkatan:"Calculate End Time",hasilPengangkatan:"Production Ends: ",alert:"Please complete all required fields correctly.",
            btnHitung:"Calculate Lifting Duration",hasilWaktuAngkat:"Lifting Duration: ",
            btnAir:"Calculate Water Recycle",hasilAirRecycle:"Required Water: ",
            btnFlowrate:"Calculate New Flowrate",hasilFlowrate:"Recommended Flow Rate: ",
            btnFormulaZatPadat:"Calculate Headbox Flowrate", hasilFormulaZatPadat:"Headbox Flowrate: ",
            optBahan0:"Select Material",
            optBahanHeadbox0: "Select Material", optBahanHeadboxBouyan: "Bouyan", optBahanHeadboxCustom: "Custom",
            lblBahanHeadbox: "Select Material:", lblGsmFormulaHeadbox: "GSM:", lblKecepatanBeltingFormulaHeadbox: "Belt Speed (m/sec):", lblLebarKertasFormulaHeadbox: "Paper Width (meter):", lblPulpConcentrationFormulaHeadbox: "Pulp Concentration (fraction):",
            notifikasi: { pesan: "The calculated production time has been reached!", tutupButton: "Close" },
            // Labels for input fields
            lblTargetProduksi:"Target Output (e.g.: 1500)", lblBeratBobbin:"Bobbin Weight (kg, e.g.: 15)", lblJumlahPotongan:"Cuts/Bobbin (e.g.: 10)", lblWaktuPengangkatan:"Lifting Time/Bobbin (min)", lblTanggalMulai:"Start Date", lblJamMulai:"Start Time (e.g., 08:00)",
            lblBerat:"Roll Weight (kg), e.g.: 16", lblBahan:"Select Material", lblGsm:"GSM (auto)", lblPisau:"Cutter (auto)", lblSpeed:"Belt Speed (m/sec, e.g.: 10.20)",
            lblJumlahRecycle:"Recycle Amount (kg, e.g.: 60)", lblMoisture:"Moisture (fraction, e.g.: 0.93)", lblKonsentrasi:"Concentration (fraction, e.g.: 0.16)",
            lblFlowAwal:"Initial flow rate (L/hr, e.g.: 100)", lblKecepatanAwal:"Initial belt speed (m/sec)", lblKecepatanBaru:"New belt speed (m/sec)",
            // Texts for Material Composition Calculator (Tab 5)
            comp: {
                lblCompProductName: "Finished Product Name:", optCompProd0: "Select Product...", lblCompBaseRecycleAmount: "Base Recycle Weight (kg):", lblCompTargetRecycleAmount: "Target Production Recycle (kg):",
                compDetailBahanTitle: "Material Details", compBahanTitle: "Material", lblCompIngredientName: "Material Name", lblCompIngredientRatio: "Material Ratio (in Base Weight):",
                txtCompKebutuhan: "Requirement", btnCompTambahBahan: "Add Material Column", btnCompHitungSemua: "Calculate All",
                compRingkasanTitle: "Summary to Copy", btnCompSalinRingkasan: "Copy Summary",
                alertCopied: "Summary copied to clipboard!", alertCopyFailed: "Failed to copy. Your browser might not support this feature or require permission.",
                alertNothingToCopy: "No significant calculation results to copy.",
                defaultProductName: "Unnamed Product",
                placeholderBaseRecycle: "e.g.: 18.75", placeholderTargetRecycle: "e.g.: 30",
                placeholderIngredientName: "Material Name", placeholderIngredientRatio: "e.g.: 0.19",
                placeholderSummary: "Calculation results will appear here..."
            },
            placeholders:{ // Original placeholders
                targetProduksi:"Target Output (e.g.: 1500)",beratBobbin:"Bobbin Weight (kg, e.g.: 15)", jumlahPotongan:"Cuts/Bobbin (e.g.: 10)",waktuPengangkatan:"Lifting Time/Bobbin (min)", tanggalMulai:"Start Date",jamMulai:"Start Time (e.g., 08:00)",
                berat:"Roll Weight (kg), e.g.: 16", gsm:"GSM (auto)", pisau:"Cutter (auto)", speed:"Belt Speed (m/sec, e.g.: 10.20)",
                jumlahRecycle:"Recycle Amount (kg, e.g.: 60)",moisture:"Moisture (fraction, e.g.: 0.93)", konsentrasi:"Concentration (fraction, e.g.: 0.16)",
                flowAwal:"Initial flow rate (L/hr, e.g.: 100)",kecepatanAwal:"Initial belt speed (m/sec)", kecepatanBaru:"New belt speed (m/sec)",
                gsmFormula: "Enter GSM (e.g.: 0.22)", kecepatanBeltingFormula: "Enter Speed (e.g.: 10.0)", lebarKertasFormula: "Enter Width (e.g.: 1.30)", pulpConcentrationFormula: "e.g.: 0.17"
            }
        },
        zh:{
            judulHalaman: "生产计算器合集",
            tab0: "生产时间", tab1: "成品提升时间", tab2: "水循环", tab3: "新流速", tab4: "网前箱流速", tab5: "材料配比", // 新标签页文本
            judul0: "生产时间计算", judul1: "成品提升时间计算", judul2: "水循环计算", judul3: "新流速计算", judul4: "网前箱流速计算", judul5: "动态材料配比计算器", // 新标签页内容标题
            btnPengangkatan: "计算结束时间", hasilPengangkatan: "生产结束于：", alert: "请正确填写所有必填字段。",
            btnHitung: "计算提升时长", hasilWaktuAngkat: "提升时长：",
            btnAir: "计算循环水量", hasilAirRecycle: "所需水量：",
            btnFlowrate: "计算新流速", hasilFlowrate: "建议流速：",
            btnFormulaZatPadat: "计算网前箱流速", hasilFormulaZatPadat: "网前箱流速：",
            optBahan0: "选择材料",
            optBahanHeadbox0: "选择材料", optBahanHeadboxBouyan: "Bouyan", optBahanHeadboxCustom: "自定义",
            lblBahanHeadbox: "选择材料：", lblGsmFormulaHeadbox: "克重：", lblKecepatanBeltingFormulaHeadbox: "带速 (米/秒)：", lblLebarKertasFormulaHeadbox: "纸宽 (米)：", lblPulpConcentrationFormulaHeadbox: "纸浆浓度 (小数)：",
            notifikasi: { pesan: "已达到计算的生产时间！", tutupButton: "关闭" },
            // 输入字段标签
            lblTargetProduksi: "目标产量 (例如：1500)", lblBeratBobbin: "筒管重量 (公斤, 例如：15)", lblJumlahPotongan: "每筒管切割数 (例如：10)", lblWaktuPengangkatan: "每筒管提升时间 (分钟)", lblTanggalMulai: "开始日期", lblJamMulai: "开始时间 (例如：08:00)",
            lblBerat: "卷重 (公斤), 例如：16", lblBahan: "选择材料", lblGsm: "克重 (自动)", lblPisau: "切刀 (自动)", lblSpeed: "带速 (米/秒, 例如：10.20)",
            lblJumlahRecycle: "回收量 (公斤, 例如：60)", lblMoisture: "水分 (小数, 例如：0.93)", lblKonsentrasi: "浓度 (小数, 例如：0.16)",
            lblFlowAwal: "初始流速 (升/小时, 例如：100)", lblKecepatanAwal: "初始带速 (米/秒)", lblKecepatanBaru: "新带速 (米/秒)",
            // 材料配比计算器文本 (标签页 5)
            comp: {
                lblCompProductName: "成品名称:", optCompProd0: "选择产品...", lblCompBaseRecycleAmount: "回收基准重量 (公斤):", lblCompTargetRecycleAmount: "目标回收产量 (公斤):",
                compDetailBahanTitle: "材料详情", compBahanTitle: "材料", lblCompIngredientName: "材料名称", lblCompIngredientRatio: "材料配比 (基于基准重量):",
                txtCompKebutuhan: "需求量", btnCompTambahBahan: "添加材料列", btnCompHitungSemua: "计算全部",
                compRingkasanTitle: "复制摘要", btnCompSalinRingkasan: "复制摘要",
                alertCopied: "摘要已复制到剪贴板！", alertCopyFailed: "复制失败。您的浏览器可能不支持此功能或需要权限。",
                alertNothingToCopy: "没有重要的计算结果可供复制。",
                defaultProductName: "未命名产品",
                placeholderBaseRecycle: "例如：18.75", placeholderTargetRecycle: "例如：30",
                placeholderIngredientName: "材料名称", placeholderIngredientRatio: "例如：0.19",
                placeholderSummary: "计算结果将显示在此处..."
            },
            placeholders: { // Original placeholders
                targetProduksi: "目标产量 (例如：1500)", beratBobbin: "筒管重量 (公斤, 例如：15)", jumlahPotongan: "每筒管切割数 (例如：10)", waktuPengangkatan: "每筒管提升时间 (分钟)", tanggalMulai: "开始日期", jamMulai: "开始时间 (例如：08:00)",
                berat: "卷重 (公斤), 例如：16", gsm: "克重 (自动)", pisau: "切刀 (自动)", speed: "带速 (米/秒, 例如：10.20)",
                jumlahRecycle: "回收量 (公斤, 例如：60)", moisture: "水分 (小数, 例如：0.93)", konsentrasi: "浓度 (小数, 例如：0.16)",
                flowAwal: "初始流速 (升/小时, 例如：100)", kecepatanAwal: "初始带速 (米/秒)", kecepatanBaru: "新带速 (米/秒)",
                gsmFormula: "输入克重 (例如：0.22)", kecepatanBeltingFormula: "输入速度 (例如：10.0)", lebarKertasFormula: "输入宽度 (例如：1.30)", pulpConcentrationFormula: "例如：0.17"
            }
        }
    };

    function setText(elementId, textContent) {
        const el = document.getElementById(elementId);
        if (el) {
            el.innerText = textContent !== undefined ? textContent : `{${elementId}}`; // Show placeholder if undefined
        } else {
            // console.warn(`Element with ID '${elementId}' not found for setText.`);
        }
    }
    function setHtml(elementId, htmlContent) {
        const el = document.getElementById(elementId);
        if (el) {
            el.innerHTML = htmlContent !== undefined ? htmlContent : `{${elementId}}`;
        } else {
            // console.warn(`Element with ID '${elementId}' not found for setHtml.`);
        }
    }


    function setPlaceholder(elementId, placeholderText) {
        const el = document.getElementById(elementId);
        if (el && (el.tagName === "INPUT" || el.tagName === "TEXTAREA") && !el.readOnly) {
            el.placeholder = placeholderText !== undefined ? placeholderText : "";
        } else if (el && el.tagName === "INPUT" && el.readOnly) {
            // For readonly inputs, we might not want placeholders, or specific ones
            el.placeholder = ""; // Or a specific placeholder for readonly if needed
        } else if (!el && elementId) {
            // console.warn(`Element with ID '${elementId}' not found for setPlaceholder.`);
        }
    }


    function ubahBahasa(){
        const lang=document.getElementById("language").value;
        const t=teks[lang];
        if (!t) {
            console.error("Language data not found for:", lang);
            return;
        }

        setText("judulHalaman", t.judulHalaman);
        ["tab0","tab1","tab2","tab3","tab4", "tab5"].forEach((id,i)=>setText(id, t["tab"+i])); // Added tab5
        ["judul0","judul1","judul2","judul3","judul4", "judul5"].forEach((id,i)=>setText(id, t["judul"+i])); // Added judul5

        setText("btnPengangkatan", t.btnPengangkatan);
        setHtml("hasilPengangkatan", t.hasilPengangkatan); // Use setHtml if it might contain formatting or to reset
        setText("btnHitung", t.btnHitung);
        setHtml("hasilWaktuAngkat", t.hasilWaktuAngkat);
        setText("btnAir", t.btnAir);
        setHtml("hasilAirRecycle", t.hasilAirRecycle);
        setText("btnFlowrate", t.btnFlowrate);
        setHtml("hasilFlowrate", t.hasilFlowrate);
        setText("btnFormulaZatPadat", t.btnFormulaZatPadat);
        setHtml("hasilFormulaZatPadat", t.hasilFormulaZatPadat);

        // Labels for tab 0
        setText("lblTargetProduksi", t.lblTargetProduksi);
        setText("lblBeratBobbin", t.lblBeratBobbin);
        setText("lblJumlahPotongan", t.lblJumlahPotongan);
        setText("lblWaktuPengangkatan", t.lblWaktuPengangkatan);
        setText("lblTanggalMulai", t.lblTanggalMulai);
        setText("lblJamMulai", t.lblJamMulai);
        // Labels for tab 1
        setText("lblBerat", t.lblBerat);
        setText("lblBahan", t.lblBahan);
        setText("optBahan0", t.optBahan0);
        setText("lblGsm", t.lblGsm);
        setText("lblPisau", t.lblPisau);
        setText("lblSpeed", t.lblSpeed);
        // Labels for tab 2
        setText("lblJumlahRecycle", t.lblJumlahRecycle);
        setText("lblMoisture", t.lblMoisture);
        setText("lblKonsentrasi", t.lblKonsentrasi);
        // Labels for tab 3
        setText("lblFlowAwal", t.lblFlowAwal);
        setText("lblKecepatanAwal", t.lblKecepatanAwal);
        setText("lblKecepatanBaru", t.lblKecepatanBaru);
        // Labels for tab 4
        setText("lblBahanHeadbox", t.lblBahanHeadbox);
        setText("optBahanHeadbox0", t.optBahanHeadbox0);
        setText("optBahanHeadboxBouyan", t.optBahanHeadboxBouyan);
        setText("optBahanHeadboxCustom", t.optBahanHeadboxCustom);
        setText("lblGsmFormulaHeadbox", t.lblGsmFormulaHeadbox);
        setText("lblKecepatanBeltingFormulaHeadbox", t.lblKecepatanBeltingFormulaHeadbox);
        setText("lblLebarKertasFormulaHeadbox", t.lblLebarKertasFormulaHeadbox);
        setText("lblPulpConcentrationFormulaHeadbox", t.lblPulpConcentrationFormulaHeadbox);


        // Set placeholders from labels if input is empty (or use dedicated placeholder texts if available)
        setPlaceholder("targetProduksi", t.placeholders.targetProduksi);
        setPlaceholder("beratBobbin", t.placeholders.beratBobbin);
        setPlaceholder("jumlahPotongan", t.placeholders.jumlahPotongan);
        setPlaceholder("waktuPengangkatan", t.placeholders.waktuPengangkatan);
        // setPlaceholder("tanggalMulai", t.placeholders.tanggalMulai); // Date input type has its own format
        setPlaceholder("jamMulai", t.placeholders.jamMulai);

        setPlaceholder("berat", t.placeholders.berat);
        setPlaceholder("gsm", t.placeholders.gsm);
        setPlaceholder("pisau", t.placeholders.pisau);
        setPlaceholder("speed", t.placeholders.speed);

        setPlaceholder("jumlahRecycle", t.placeholders.jumlahRecycle);
        setPlaceholder("moisture", t.placeholders.moisture);
        setPlaceholder("konsentrasi", t.placeholders.konsentrasi);

        setPlaceholder("flowAwal", t.placeholders.flowAwal);
        setPlaceholder("kecepatanAwal", t.placeholders.kecepatanAwal);
        setPlaceholder("kecepatanBaru", t.placeholders.kecepatanBaru);

        setPlaceholder("gsmFormula", t.placeholders.gsmFormula);
        setPlaceholder("kecepatanBeltingFormula", t.placeholders.kecepatanBeltingFormula);
        setPlaceholder("lebarKertasFormula", t.placeholders.lebarKertasFormula);
        setPlaceholder("pulpConcentrationFormula", t.placeholders.pulpConcentrationFormula);


        // Texts for Kalkulator Komposisi Bahan (Tab 5)
        if (t.comp) {
            setText("lblCompProductName", t.comp.lblCompProductName);
            setText("optCompProd0", t.comp.optCompProd0);
            setText("lblCompBaseRecycleAmount", t.comp.lblCompBaseRecycleAmount);
            setText("lblCompTargetRecycleAmount", t.comp.lblCompTargetRecycleAmount);
            setText("compDetailBahanTitle", t.comp.compDetailBahanTitle);
            setText("btnCompTambahBahan", t.comp.btnCompTambahBahan);
            setText("btnCompHitungSemua", t.comp.btnCompHitungSemua);
            setText("compRingkasanTitle", t.comp.compRingkasanTitle);
            setText("btnCompSalinRingkasan", t.comp.btnCompSalinRingkasan);
            setText("txtCompKebutuhan", t.comp.txtCompKebutuhan);

            setPlaceholder("compBaseRecycleAmount", t.comp.placeholderBaseRecycle);
            setPlaceholder("compTargetRecycleAmount", t.comp.placeholderTargetRecycle);
            setPlaceholder("compSummaryForCopy", t.comp.placeholderSummary);

            // Update dynamic ingredient labels
            updateCompIngredientDisplayNames(); // This will handle Bahan X, Nama Bahan X etc.
        }


        aturGSMdanPisau();
        aturInputHeadbox();

        const popupNotifikasi = document.getElementById("notifikasiSelesaiPopup");
        if (popupNotifikasi && popupNotifikasi.classList.contains("show") && t.notifikasi) {
            setText("teksNotifikasiSelesai", t.notifikasi.pesan);
            setText("btnTutupNotifikasi", t.notifikasi.tutupButton);
        }
    }

    function showTab(index){
        document.querySelectorAll(".tab").forEach((tab,i)=>{
            tab.classList.toggle("active",i===index);
        });
        document.querySelectorAll(".content").forEach((c,i)=>{
            c.classList.toggle("active",i===index);
        });
    }

    function getValue(id, defaultValue = null, isNumeric = true) {
        const element = document.getElementById(id);
        if (!element) {
            // console.warn(`getValue: Element with ID '${id}' not found.`);
            return defaultValue;
        }
        let value = element.value;
        if (isNumeric) {
            value = parseFloat(value);
            return isNaN(value) ? defaultValue : value;
        }
        return value === "" ? defaultValue : value;
    }

    // --- Functions for Tab 0 ---
    function hitungWaktuPengangkatan(){
        const lang=document.getElementById("language").value;
        const t=teks[lang];
        tutupNotifikasiSelesai();
        if (intervalCekWaktuNotifikasi) {
            clearInterval(intervalCekWaktuNotifikasi);
            intervalCekWaktuNotifikasi = null;
        }
        targetWaktuSelesaiNotifikasi = null;
        notifikasiSudahDitampilkan = false;

        const target = getValue("targetProduksi");
        const berat = getValue("beratBobbin");
        const pot = getValue("jumlahPotongan");
        const waktuPengangkatanPerBobbin = getValue("waktuPengangkatan");
        const jamMulai = getValue("jamMulai", null, false);
        const tgl = getValue("tanggalMulai", null, false);

        if(target === null || target <= 0 || berat === null || berat <= 0 || pot === null || pot <= 0 || waktuPengangkatanPerBobbin === null || waktuPengangkatanPerBobbin <= 0 || !jamMulai || !tgl){
            alert(t.alert);
            setHtml("hasilPengangkatan",t.hasilPengangkatan);
            return;
        }
        const jumlahBobbin = target / (berat * pot);
        const totalWaktuPengangkatanMenit = jumlahBobbin * waktuPengangkatanPerBobbin;
        const [y,m,d]=tgl.split("-").map(Number);
        const [h,parsedMin]=jamMulai.split(":").map(Number);
        const dt=new Date(y,m-1,d,h,parsedMin);
        dt.setMinutes(dt.getMinutes() + Math.round(totalWaktuPengangkatanMenit));

        targetWaktuSelesaiNotifikasi = new Date(dt.getTime());

        const dateOptions = {year:"numeric",month:"2-digit",day:"2-digit"};
        let localeString = "id-ID";
        if (lang === "en") localeString = "en-US";
        else if (lang === "zh") localeString = "zh-CN";

        const dateStr=dt.toLocaleDateString(localeString, dateOptions);
        const timeStr=dt.toTimeString().slice(0,5);
        setHtml("hasilPengangkatan", t.hasilPengangkatan+dateStr+" "+timeStr);

        if (targetWaktuSelesaiNotifikasi > new Date()) {
            intervalCekWaktuNotifikasi = setInterval(cekWaktuProduksiSelesaiSecaraBerkala, 5000);
            cekWaktuProduksiSelesaiSecaraBerkala();
        } else {
            cekWaktuProduksiSelesaiSecaraBerkala();
        }
    }

    // --- Functions for Tab 1 ---
    function aturGSMdanPisau(){
        const b=document.getElementById("bahan").value;
        const gsmEl=document.getElementById("gsm");
        const pisauEl=document.getElementById("pisau");
        const lblGsmEl = document.getElementById("lblGsm");
        const lblPisauEl = document.getElementById("lblPisau");
        const lang = document.getElementById("language").value;
        const t = teks[lang];

        if (gsmEl) setPlaceholder("gsm", t.placeholders.gsm);
        if (pisauEl) setPlaceholder("pisau", t.placeholders.pisau);

        let gsmVal = "", pisauVal = "";

        if(b==="Bouyan"){gsmVal=0.22;pisauVal=0.109;}
        else if(b==="BAT"){gsmVal=0.18;pisauVal=0.138;}
        else if(b==="Highlander"){gsmVal=0.095;pisauVal=0.2;}

        const showFields = b !== "";
        [gsmEl, pisauEl, lblGsmEl, lblPisauEl].forEach(el => {
            if (el) el.classList.toggle("hidden", !showFields);
        });

        if (gsmEl) { gsmEl.value = gsmVal; gsmEl.readOnly = showFields; }
        if (pisauEl) { pisauEl.value = pisauVal; pisauEl.readOnly = showFields; }
    }

    function hitungWaktuAngkat(){
        const lang=document.getElementById("language").value;
        const t=teks[lang];
        const gsm = getValue("gsm");
        const pis = getValue("pisau");
        let speed = getValue("speed");
        const berat = getValue("berat");

        if(gsm === null || pis === null || speed === null || berat === null || gsm <= 0 || pis <= 0 || speed <= 0 || berat <= 0){
            alert(t.alert);
            setHtml("hasilWaktuAngkat",t.hasilWaktuAngkat);
            return;
        }
        const dur=berat/(gsm*pis*speed);
        setHtml("hasilWaktuAngkat",t.hasilWaktuAngkat+dur.toFixed(2)+(lang==="zh"?" 秒":lang==="en"?" seconds":" detik"));
    }

    // --- Functions for Tab 2 ---
    function hitungAirRecycle(){
        const lang=document.getElementById("language").value;
        const t=teks[lang];
        const jr = getValue("jumlahRecycle");
        const mo = getValue("moisture");
        const ko = getValue("konsentrasi");

        if(jr === null || jr <= 0 || mo === null || mo <= 0 || mo >= 1 || ko === null || ko <= 0 || ko >= 1){
            alert(t.alert);
            setHtml("hasilAirRecycle",t.hasilAirRecycle);
            return;
        }
        const air=(jr*mo)/ko-jr;
        setHtml("hasilAirRecycle", t.hasilAirRecycle+air.toFixed(2) + " kg");
    }

    // --- Functions for Tab 3 ---
    function hitungFlowrateBaru(){
        const lang=document.getElementById("language").value;
        const t=teks[lang];
        const fa = getValue("flowAwal");
        const ka = getValue("kecepatanAwal");
        const kb = getValue("kecepatanBaru");

        if(fa === null || ka === null || kb === null || ka == 0 ){
            alert(t.alert);
            setHtml("hasilFlowrate",t.hasilFlowrate);
            return;
        }
        const fr=fa/ka*kb;
        setHtml("hasilFlowrate", t.hasilFlowrate+fr.toFixed(2) + " L/jam");
    }

    // --- Functions for Tab 4 ---
    function aturInputHeadbox() {
        const bahanValue = document.getElementById("bahanHeadbox").value;
        const gsmEl = document.getElementById("gsmFormula");
        const kecepatanEl = document.getElementById("kecepatanBeltingFormula");
        const lebarEl = document.getElementById("lebarKertasFormula");
        const lang = document.getElementById("language").value;
        const t = teks[lang];

        setPlaceholder("gsmFormula", t.placeholders.gsmFormula);
        setPlaceholder("kecepatanBeltingFormula", t.placeholders.kecepatanBeltingFormula);
        setPlaceholder("lebarKertasFormula", t.placeholders.lebarKertasFormula);

        let gsmVal = "", kecepatanVal = "", lebarVal = "";
        let gsmRO = false, kecepatanRO = false, lebarRO = false;

        if (bahanValue === "Bouyan") {
            gsmVal = 0.22; kecepatanVal = 10.20; lebarVal = 1.28;
            gsmRO = true; kecepatanRO = true; lebarRO = true;
        }

        if (gsmEl) { gsmEl.value = gsmVal; gsmEl.readOnly = gsmRO; }
        if (kecepatanEl) { kecepatanEl.value = kecepatanVal; kecepatanEl.readOnly = kecepatanRO; }
        if (lebarEl) { lebarEl.value = lebarVal; lebarEl.readOnly = lebarRO; }
    }

    function hitungFormulaHeadbox(){
        const lang = document.getElementById("language").value;
        const t = teks[lang];
        const gsm = getValue("gsmFormula");
        const speed = getValue("kecepatanBeltingFormula");
        const paperWidth = getValue("lebarKertasFormula");
        const pulpConcentration = getValue("pulpConcentrationFormula");
        const konstantaAir = 0.93;
        const konstantaTetap = 1.04;

        if (gsm === null || gsm <= 0 || speed === null || speed <= 0 || paperWidth === null || paperWidth <= 0 || pulpConcentration === null || pulpConcentration <= 0) {
            alert(t.alert);
            setHtml("hasilFormulaZatPadat", t.hasilFormulaZatPadat);
            return;
        }
        const hasil = (gsm * konstantaAir * speed * paperWidth) / pulpConcentration / konstantaTetap;
        setHtml("hasilFormulaZatPadat", t.hasilFormulaZatPadat + hasil.toFixed(2));
    }

    // --- Functions for Kalkulator Komposisi Bahan (Tab 5) ---
    let compIngredientCounter = 1;

    function addCompIngredientColumn() {
        compIngredientCounter++;
        const container = document.getElementById('compIngredientSectionsContainer');
        const lang = document.getElementById("language").value;
        const t = teks[lang].comp;

        const newIngredientHTML = `
            <div class="input-group" data-ingredient-id="${compIngredientCounter}">
                <h3>${t.compBahanTitle} ${compIngredientCounter}</h3>
                <label for="compIngredientName${compIngredientCounter}">${t.lblCompIngredientName} ${compIngredientCounter}:</label>
                <input type="text" id="compIngredientName${compIngredientCounter}" class="comp-ingredient-name-input" placeholder="${t.placeholderIngredientName}">

                <label for="compIngredientRatio${compIngredientCounter}">${t.lblCompIngredientRatio.replace('Bhn', t.compBahanTitle)} ${compIngredientCounter} (dlm Berat Acuan):</label>
                <input type="number" id="compIngredientRatio${compIngredientCounter}" class="comp-ingredient-ratio-input" placeholder="${t.placeholderIngredientRatio}" step="any">

                <p>${t.txtCompKebutuhan} <span class="compIngredientNameDisplay" id="compIngredientNameDisplay${compIngredientCounter}">${t.compBahanTitle} ${compIngredientCounter}</span>: <span class="result-text comp-ingredient-result" id="compIngredientResult${compIngredientCounter}">0.00</span> kg</p>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', newIngredientHTML);
        attachCompEventListenersToNewInputs(compIngredientCounter);
        updateCompIngredientDisplayNames();
        calculateCompAll();
    }

    function updateCompIngredientDisplayNames() {
        const lang = document.getElementById("language").value;
        const t = teks[lang].comp;

        const nameInputs = document.querySelectorAll('.comp-ingredient-name-input');
        nameInputs.forEach(input => {
            const idNum = input.id.replace('compIngredientName', '');
            const displaySpan = document.getElementById(`compIngredientNameDisplay${idNum}`);
            const titleH3 = document.querySelector(`.input-group[data-ingredient-id="${idNum}"] h3`);

            if (displaySpan) {
                displaySpan.textContent = input.value || `${t.compBahanTitle} ${idNum}`;
            }
            if (titleH3) {
                titleH3.textContent = input.value || `${t.compBahanTitle} ${idNum}`;
            }
            // Update labels for name and ratio
            const nameLabel = document.getElementById(`lblCompIngredientName${idNum}`);
            if (nameLabel) nameLabel.textContent = `${t.lblCompIngredientName} ${idNum}:`;

            const ratioLabel = document.getElementById(`lblCompIngredientRatio${idNum}`);
            if (ratioLabel) ratioLabel.textContent = `${t.lblCompIngredientRatio.replace('Bhn', t.compBahanTitle)} ${idNum}:`;

            // Update title H3 for Bahan 1 initially if needed
            if (idNum === '1') {
                const bahan1Title = document.getElementById('compBahan1Title');
                if (bahan1Title) bahan1Title.textContent = input.value || `${t.compBahanTitle} 1`;
                const lblBahan1Name = document.getElementById('lblCompIngredientName1');
                if (lblBahan1Name) lblBahan1Name.textContent = `${t.lblCompIngredientName} 1:`;
                 const lblBahan1Ratio = document.getElementById('lblCompIngredientRatio1');
                if (lblBahan1Ratio) lblBahan1Ratio.textContent = `${t.lblCompIngredientRatio.replace('Bhn', t.compBahanTitle)} 1:`;

            }
        });
    }


    function attachCompEventListeners() {
        const compInputs = document.querySelectorAll('#tab-5 .overall-inputs input, #tab-5 .overall-inputs select, #tab-5 .input-group input');
        compInputs.forEach(input => {
            input.addEventListener('input', () => {
                if (input.classList.contains('comp-ingredient-name-input')) {
                    updateCompIngredientDisplayNames();
                }
                calculateCompAll();
            });
        });
         // Initial placeholder setup for dynamically added elements' potential placeholders
        setPlaceholder(`compIngredientName1`, teks[document.getElementById("language").value].comp.placeholderIngredientName);
        setPlaceholder(`compIngredientRatio1`, teks[document.getElementById("language").value].comp.placeholderIngredientRatio);

    }

    function attachCompEventListenersToNewInputs(idNum) {
        const lang = document.getElementById("language").value;
        const t = teks[lang].comp;

        const nameInput = document.getElementById(`compIngredientName${idNum}`);
        if (nameInput) {
            nameInput.placeholder = t.placeholderIngredientName;
            nameInput.addEventListener('input', () => {
                updateCompIngredientDisplayNames();
                calculateCompAll();
            });
        }

        const ratioInput = document.getElementById(`compIngredientRatio${idNum}`);
        if (ratioInput) {
            ratioInput.placeholder = t.placeholderIngredientRatio;
            ratioInput.addEventListener('input', calculateCompAll);
        }
    }

    function calculateCompAll() {
        const lang = document.getElementById("language").value;
        const t = teks[lang].comp;

        const productNameElement = document.getElementById("compProductName");
        const productName = productNameElement.value || t.defaultProductName;

        const baseRecycle = parseFloat(document.getElementById("compBaseRecycleAmount").value) || 0;
        const targetRecycle = parseFloat(document.getElementById("compTargetRecycleAmount").value) || 0;

        let summaryText = `${t.lblCompProductName} ${productName}\n${t.lblCompTargetRecycleAmount.replace('(kg):', '')} ${targetRecycle.toFixed(2)} kg\n---\n${t.compDetailBahanTitle}:\n`;
        let totalCalculatedWeight = 0;

        const ingredientGroups = document.querySelectorAll('#compIngredientSectionsContainer .input-group');
        ingredientGroups.forEach(group => {
            const id = group.dataset.ingredientId;
            const nameInput = document.getElementById(`compIngredientName${id}`);
            const ratioInput = document.getElementById(`compIngredientRatio${id}`);
            const resultDisplay = document.getElementById(`compIngredientResult${id}`);

            const name = nameInput ? (nameInput.value || `${t.compBahanTitle} ${id}`) : `${t.compBahanTitle} ${id}`;
            const ratio = ratioInput ? (parseFloat(ratioInput.value) || 0) : 0;

            let result = 0;
            if (baseRecycle > 0) {
                result = (ratio / baseRecycle) * targetRecycle;
            }

            if(resultDisplay) resultDisplay.textContent = result.toFixed(2);
            summaryText += `${name}: ${result.toFixed(2)} kg\n`;
            totalCalculatedWeight += result;
        });

        summaryText += `---\nTotal Estimasi Berat Bahan Untuk Perset: ${totalCalculatedWeight.toFixed(2)} kg`;
        const summaryTextarea = document.getElementById("compSummaryForCopy");
        if (summaryTextarea) summaryTextarea.value = summaryText;
        updateCompIngredientDisplayNames();
    }

    function copyCompSummary() {
        const lang = document.getElementById("language").value;
        const t = teks[lang].comp;
        const summaryTextarea = document.getElementById("compSummaryForCopy");

        if (!summaryTextarea || summaryTextarea.value.trim() === "" || !summaryTextarea.value.includes(':')) {
            alert(t.alertNothingToCopy);
            return;
        }
        // Further check if it only contains default headers and no actual data
        if (summaryTextarea.value.includes(t.defaultProductName) && summaryTextarea.value.includes("Target Produksi Recycle (kg): 0.00 kg") && summaryTextarea.value.includes("Total Estimasi Berat Bahan Untuk Perset: 0.00 kg")) {
            let hasMeaningfulData = false;
            document.querySelectorAll('#compIngredientSectionsContainer .input-group').forEach(group => {
                 const id = group.dataset.ingredientId;
                 const ratioInput = document.getElementById(`compIngredientRatio${id}`);
                 if (ratioInput && (parseFloat(ratioInput.value) || 0) !== 0) {
                     hasMeaningfulData = true;
                 }
            });
            if (!hasMeaningfulData && (parseFloat(document.getElementById("compBaseRecycleAmount").value) || 0) === 0 && (parseFloat(document.getElementById("compTargetRecycleAmount").value) || 0) === 0) {
                 alert(t.alertNothingToCopy);
                 return;
            }
        }


        summaryTextarea.select();
        summaryTextarea.setSelectionRange(0, 99999);
        try {
            document.execCommand("copy");
            alert(t.alertCopied);
        } catch (err) {
            alert(t.alertCopyFailed);
        }
    }


    // --- General Functions & Init ---
    function tampilkanNotifikasiProduksiSelesai() {
        const lang = document.getElementById("language").value;
        const t = teks[lang];
        const popup = document.getElementById("notifikasiSelesaiPopup");
        if(popup && t && t.notifikasi) {
            setText("teksNotifikasiSelesai", t.notifikasi.pesan);
            setText("btnTutupNotifikasi", t.notifikasi.tutupButton);
            popup.classList.add("show");
        }
        notifikasiSudahDitampilkan = true;
        if (intervalCekWaktuNotifikasi) {
            clearInterval(intervalCekWaktuNotifikasi);
            intervalCekWaktuNotifikasi = null;
        }
    }

    function tutupNotifikasiSelesai() {
        const popup = document.getElementById("notifikasiSelesaiPopup");
        if (popup) popup.classList.remove("show");
    }

    function cekWaktuProduksiSelesaiSecaraBerkala() {
        if (!targetWaktuSelesaiNotifikasi || notifikasiSudahDitampilkan) {
            return;
        }
        const sekarang = new Date();
        if (sekarang >= targetWaktuSelesaiNotifikasi) {
            tampilkanNotifikasiProduksiSelesai();
        }
    }

    window.onload = function() {
        const tanggalMulaiEl = document.getElementById('tanggalMulai');
        if(tanggalMulaiEl && !tanggalMulaiEl.value) {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedToday = `${year}-${month}-${day}`;
            tanggalMulaiEl.value = formattedToday;
        }
        // Initialize Kalkulator Komposisi Bahan event listeners and initial state
        attachCompEventListeners();
        updateCompIngredientDisplayNames(); // Ensure initial names and placeholders are set based on language
        calculateCompAll(); // Perform initial calculation if there are default values

        ubahBahasa(); // This will set all texts according to the default selected language
        tutupNotifikasiSelesai();
    };
</script>
</body>
</html>
