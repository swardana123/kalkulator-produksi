<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Produksi Lengkap</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
 background: linear-gradient(to bottom right, #e3f2fd, #ffffff); margin:0; padding:10px; color:#333; }
    .header { display:flex; flex-direction:column; gap:10px; align-items:center; margin-bottom:20px;
 }
    .header img { max-width: 100px; height: auto; margin-bottom: 5px;
      mix-blend-mode: multiply;
 }
    .header h1 { font-size:1.5rem; text-align:center; margin-top: 0; margin-bottom: 5px; }
    select { padding:8px;
 font-size:1rem; border-radius:6px; border:1px solid #ccc; }
    .tab-container { display:flex; flex-wrap: wrap; margin-bottom:10px; border-radius:8px; overflow:hidden;
 box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .tab { flex:1; min-width: 150px; padding:10px; background-color:#eee; text-align:center; cursor:pointer; transition:background-color .3s;
 font-size:.90rem; border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;}
    .tab:last-child { border-right: none;
 }
    .tab.active { background-color:#2196F3; color:white; font-weight:bold; border-bottom-color: #2196F3; }
    .content { display:none; background:white; padding:15px;
 border-radius:0 0 8px 8px; box-shadow:0 2px 10px rgba(0,0,0,.1); animation: fadeIn 0.5s; margin-top:-1px;
 }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1;
 } }
    .content.active { display:block; }
    .content input[type="text"], .content input[type="number"], .content input[type="time"], .content input[type="date"], .content select, .content button, .content textarea { 
        width:100%; max-width:400px; padding:10px;
        margin:8px 0; font-size:1rem; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; 
    }
    .content label { display: block; margin-top: 10px; font-weight: bold;
 font-size: 0.9rem; color: #555;}
    .content button { background-color:#2196F3; color:white; border:none; cursor:pointer; transition: background-color 0.3s;
 }
    .content button:hover { background-color:#1976D2; }

    .hasil { margin-top:10px; padding: 10px; background-color: #e8f5e9;
 border-left: 5px solid #4CAF50; font-weight:bold; color:#2E7D32; border-radius: 4px; }
    .hidden { display:none !important;
 }
    input[readonly] {
        background-color: #e9ecef;
        color: #495057;
        cursor: not-allowed;
 }
    .content h2 { margin-top: 0; color: #1976D2; }
    .content h3 { color: #34495e; margin-top: 20px; margin-bottom:10px; text-align: left; border-bottom: 1px solid #eee; padding-bottom: 5px;}

    .rc-result-text { font-weight: bold; color: #27ae60; }
    .rc-input-group { margin-bottom: 20px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 5px; background-color: #f9f9f9; }
    .rc-overall-inputs { background-color: #e8f4fd; padding: 20px; border-radius: 5px; margin-bottom: 25px; }
    .rc-add-ingredient-btn { background-color: #2ecc71 !important; margin-top: 10px !important; margin-bottom: 10px !important; }
    .rc-add-ingredient-btn:hover { background-color: #27ae60 !important; }
    .rc-content textarea#rc_summaryForCopy { min-height: 100px;} 

    .notifikasi-popup {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        background-color: #4CAF50;
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: opacity 0.5s, transform 0.5s;
        opacity: 0;
        transform: translateY(100px);
        pointer-events: none; 
        cursor: pointer; 
 }
    .notifikasi-popup.show {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto; 
 }

pre#responseAreaGroq {
  white-space: pre-wrap;
  word-break: break-word;
  overflow-wrap: break-wrap;
  max-width: 100%;
  overflow-x: auto;
 }
</style>
</head>
<body>
  <div class="header">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSPx-6VZHoYrLUtrsSA2ih9SEeDIqqc2tMeK766Vw2eBKap-ajfgU05Biw&s=10" alt="Calculator Logo">
    <select id="language" onchange="ubahBahasa()">
      <option value="id">Bahasa Indonesia</option>
      <option value="en">English</option>
      <option value="zh">中文 (Mandarin)</option>
    </select>
    <h1 id="judulHalaman">Gabungan Kalkulator Produksi</h1>
  </div>

  <div class="tab-container">
    <div class="tab active" onclick="showTab(0)" id="tab0_btn">Hitung Waktu Produksi</div>
    <div class="tab" onclick="showTab(1)" id="tab1_btn">Waktu Angkat Finish Good</div>
    <div class="tab" onclick="showTab(2)" id="tab2_btn">Air Recycle</div>
    <div class="tab" onclick="showTab(3)" id="tab3_btn">Flowrate Baru</div>
    <div class="tab" onclick="showTab(4)" id="tab4_btn">Flowrate Headbox</div>
    <div class="tab" onclick="showTab(5)" id="tab5_btn">AI Huabao</div>
    <div class="tab" onclick="showTab(6)" id="tab6_btn">Kalkulator Bahan Recycle</div>
  </div>

  <div id="tab-0" class="content active">
    <h2 id="judul0">Hitung Waktu Produksi</h2>
    <label for="targetProduksi" id="lblTargetProduksi">Target Produksi</label>
    <input id="targetProduksi" type="number" />
    <label for="beratBobbin" id="lblBeratBobbin">Berat Bobbin (kg)</label>
    <input id="beratBobbin" type="number" />
    <label for="jumlahPotongan" id="lblJumlahPotongan">Potongan/Bobbin</label>
    <input id="jumlahPotongan" type="number" />
    <label for="waktuPengangkatan" id="lblWaktuPengangkatan">Waktu Angkat/Bobbin (menit)</label>
    <input id="waktuPengangkatan" type="number" />
    <label for="tanggalMulai" id="lblTanggalMulai">Tanggal Mulai</label>
    <input id="tanggalMulai" type="date" />
    <label for="jamMulai" id="lblJamMulai">Jam Mulai</label>
    <input id="jamMulai" type="time" />
    <button onclick="hitungWaktuPengangkatan()" id="btnPengangkatan">Hitung Waktu Selesai</button>
    <div class="hasil" id="hasilPengangkatan">Waktu Selesai Produksi: </div>
  </div>

  <div id="tab-1" class="content">
    <h2 id="judul1">Perhitungan Waktu Angkat Finish Good</h2>
    <label for="berat" id="lblBerat">Berat Roll (kg)</label>
    <input id="berat" type="number" />
    <label for="bahan" id="lblBahan">Pilih Bahan</label>
    <select id="bahan" onchange="aturGSMdanPisau()">
      <option id="optBahan0" value="">Pilih Bahan</option>
      <option id="optBahan1" value="Bouyan">Bouyan</option>
      <option id="optBahan2" value="BAT">BAT</option>
      <option id="optBahan3" value="Highlander">Highlander</option>
    </select>
    <label class="hidden" for="gsm" id="lblGsm">GSM</label>
    <input class="hidden" id="gsm" type="number" readonly/>
    <label class="hidden" for="pisau" id="lblPisau">Pisau</label>
    <input class="hidden" id="pisau" type="number" readonly/>
    <label for="speed" id="lblSpeed">Kecepatan Belting (m/detik)</label>
    <input id="speed" type="number" />
    <button onclick="hitungWaktuAngkat()" id="btnHitung">Hitung Durasi Angkat</button>
    <div class="hasil" id="hasilWaktuAngkat">Durasi Angkat: </div>
  </div>

  <div id="tab-2" class="content">
    <h2 id="judul2">Perhitungan Air Recycle</h2>
    <label for="jumlahRecycle" id="lblJumlahRecycle">Jumlah Recycle (kg)</label>
    <input id="jumlahRecycle" type="number" />
    <label for="moisture" id="lblMoisture">Moisture (fraksi)</label>
    <input id="moisture" type="number" step="any" />
    <label for="konsentrasi" id="lblKonsentrasi">Konsentrasi (fraksi)</label>
    <input id="konsentrasi" type="number" step="any" />
    <button onclick="hitungAirRecycle()" id="btnAir">Hitung Air Recycle</button>
    <div class="hasil" id="hasilAirRecycle">Jumlah Air yang Diperlukan: </div>
  </div>

  <div id="tab-3" class="content">
    <h2 id="judul3">Flowrate Baru</h2>
    <label for="flowAwal" id="lblFlowAwal">Flow rate awal (L/jam)</label>
    <input id="flowAwal" type="number" step="any" />
    <label for="kecepatanAwal" id="lblKecepatanAwal">Kecepatan belting awal (m/detik)</label>
    <input id="kecepatanAwal" type="number" step="any" />
    <label for="kecepatanBaru" id="lblKecepatanBaru">Kecepatan belting baru (m/detik)</label>
    <input id="kecepatanBaru" type="number" step="any" />
    <button onclick="hitungFlowrateBaru()" id="btnFlowrate">Hitung Flowrate Baru</button>
    <div class="hasil" id="hasilFlowrate">Laju Aliran Disarankan: </div>
  </div>

  <div id="tab-4" class="content">
    <h2 id="judul4">Mencari Flow rate Headbox</h2>
    <label for="bahanHeadbox" id="lblBahanHeadbox">Pilih Material:</label>
    <select id="bahanHeadbox" onchange="aturInputHeadbox()">
      <option id="optBahanHeadbox0" value="">Pilih Material</option>
      <option id="optBahanHeadboxBouyan" value="Bouyan">Bouyan</option>
      <option id="optBahanHeadboxCustom" value="Custom">Custom</option>
    </select>
    <label for="gsmFormula" id="lblGsmFormulaHeadbox">GSM:</label>
    <input id="gsmFormula" type="number" step="any"/>
    <label for="kecepatanBeltingFormula" id="lblKecepatanBeltingFormulaHeadbox">Kecepatan Belting (m/detik):</label>
    <input id="kecepatanBeltingFormula" type="number" step="any"/>
    <label for="lebarKertasFormula" id="lblLebarKertasFormulaHeadbox">Lebar Kertas (meter):</label>
    <input id="lebarKertasFormula" type="number" step="any"/>
    <label for="pulpConcentrationFormula" id="lblPulpConcentrationFormulaHeadbox">Konsentrasi Pulp (fraksi):</label>
    <input id="pulpConcentrationFormula" type="number" step="any"/>
    <button onclick="hitungFormulaHeadbox()" id="btnFormulaZatPadat">Hitung Flowrate Headbox</button>
    <div class="hasil" id="hasilFormulaZatPadat">Flowrate Headbox: </div>
  </div>

  <div id="tab-5" class="content">
    <h2 id="judul5">Chat dengan Huabao Assisten</h2>
    <textarea id="inputTextGroq" rows="5" placeholder="Tulis pertanyaan Anda di sini..."></textarea><br>
    <button onclick="sendToGroq()" id="btnSendToGroq">Kirim</button>
    <h3 id="headerJawabanAI">Jawaban AI:</h3>
    <pre id="responseAreaGroq">Belum ada jawaban.</pre>
  </div>

  <div id="tab-6" class="content rc-content">
    <h2 id="rc_judulKalkulator">Kalkulator Komposisi Bahan Dinamis</h2>

    <div class="rc-overall-inputs">
        <label for="rc_productName" id="rc_lblProductName">Nama Produk Jadi:</label>
        <input type="text" id="rc_productName" list="rc_productNameSuggestionsDatalist" placeholder="Mis: Produk ABC" onblur="saveProductName_Recycle(this.value)">
        <datalist id="rc_productNameSuggestionsDatalist"></datalist>

        <label for="rc_baseRecycleAmount" id="rc_lblBaseRecycleAmount">Berat Acuan Recycle (kg):</label>
        <input type="number" id="rc_baseRecycleAmount" placeholder="Contoh: 18.75" step="any">

        <label for="rc_targetRecycleAmount" id="rc_lblTargetRecycleAmount">Target Produksi Recycle (kg):</label>
        <input type="number" id="rc_targetRecycleAmount" placeholder="Contoh: 30" step="any">
    </div>

    <h3 id="rc_headerDetailBahan">Detail Bahan</h3>
    <div id="rc_ingredientSectionsContainer">
        <div class="rc-input-group" data-ingredient-id="1">
            <h3 id="rc_headerBahan1">Bahan 1</h3>
            <label for="rc_ingredientName1" id="rc_lblNamaBahan1">Nama Bahan 1:</label>
            <input type="text" id="rc_ingredientName1" class="rc-ingredient-name-input" placeholder="Nama Bahan">
            <label for="rc_ingredientRatio1" id="rc_lblRasioBhn1">Rasio Bhn 1 (dlm Berat Acuan):</label>
            <input type="number" id="rc_ingredientRatio1" class="rc-ingredient-ratio-input" placeholder="Mis: 0.19" step="any">
            <p><span id="rc_lblKebutuhan1">Kebutuhan</span> <span class="rc-ingredientNameDisplay" id="rc_ingredientNameDisplay1">Bahan 1</span>: <span class="rc-result-text rc-ingredient-result" id="rc_ingredientResult1">0.00</span> kg</p>
        </div>
    </div>
    
    <button onclick="addIngredientColumn_Recycle()" class="rc-add-ingredient-btn" id="rc_btnAddCol">Tambah Kolom Bahan</button>
    <button onclick="calculateAll_Recycle()" id="rc_btnCalcAll">Hitung Semua</button> 
    
    <h3 id="rc_headerRingkasan">Ringkasan untuk Disalin</h3>
    <textarea id="rc_summaryForCopy" rows="8" placeholder="Hasil perhitungan akan muncul di sini..." readonly></textarea>
    <button onclick="copySummary_Recycle()" id="rc_btnCopySummary">Salin Ringkasan</button>
  </div>
  <div id="notifikasiSelesaiPopup" class="notifikasi-popup" onclick="tutupNotifikasiSelesai()">
    <span id="teksNotifikasiSelesai"></span>
  </div>

<script>
//=============== BEGIN INTERNATIONALIZATION (i18n) OBJECT ===============
const teks = {
  id:{
    judulHalaman:"Gabungan Kalkulator Produksi",
    tab0_btn:"Hitung Waktu Produksi", tab1_btn:"Waktu Angkat Finish Good", tab2_btn:"Air Recycle", tab3_btn:"Flowrate Baru", tab4_btn:"Flowrate Headbox", tab5_btn:"AI Huabao", tab6_btn:"Kalkulator Bahan Recycle",
    judul0:"Hitung Waktu Produksi", judul1:"Perhitungan Waktu Angkat Finish Good", judul2:"Perhitungan Air Recycle", judul3:"Flowrate Baru", judul4:"Mencari Flow rate Headbox", judul5:"Chat dengan Huabao Assisten",
    lblTargetProduksi: "Target Produksi", lblBeratBobbin: "Berat Bobbin (kg)", lblJumlahPotongan: "Potongan/Bobbin", lblWaktuPengangkatan: "Waktu Angkat/Bobbin (menit)", lblTanggalMulai: "Tanggal Mulai", lblJamMulai: "Jam Mulai",
    btnPengangkatan:"Hitung Waktu Selesai", hasilPengangkatan:"Waktu Selesai Produksi: ", alert:"Mohon lengkapi semua data yang diperlukan dengan benar.",
    lblBerat:"Berat Roll (kg)", lblBahan:"Pilih Bahan", lblGsm:"GSM", lblPisau:"Pisau", lblSpeed:"Kecepatan Belting (m/detik)",
    btnHitung:"Hitung Durasi Angkat", hasilWaktuAngkat:"Durasi Angkat: ",
    lblJumlahRecycle: "Jumlah Recycle (kg)", lblMoisture: "Moisture (fraksi)", lblKonsentrasi: "Konsentrasi (fraksi)",
    btnAir:"Hitung Air Recycle", hasilAirRecycle:"Jumlah Air yang Diperlukan: ",
    lblFlowAwal: "Flow rate awal (L/jam)", lblKecepatanAwal: "Kecepatan belting awal (m/detik)", lblKecepatanBaru: "Kecepatan belting baru (m/detik)",
    btnFlowrate:"Hitung Flowrate Baru", hasilFlowrate:"Laju Aliran Disarankan: ",
    btnFormulaZatPadat:"Hitung Flowrate Headbox", hasilFormulaZatPadat:"Flowrate Headbox: ",
    optBahan0:"Pilih Bahan", optBahan1:"Bouyan", optBahan2:"BAT", optBahan3:"Highlander",
    optBahanHeadbox0: "Pilih Material", optBahanHeadboxBouyan: "Bouyan", optBahanHeadboxCustom: "Kustom",
    lblBahanHeadbox: "Pilih Material:", lblGsmFormulaHeadbox: "GSM:", lblKecepatanBeltingFormulaHeadbox: "Kecepatan Belting (m/detik):", lblLebarKertasFormulaHeadbox: "Lebar Kertas (meter):", lblPulpConcentrationFormulaHeadbox: "Konsentrasi Pulp (fraksi):",
    btnSendToGroq: "Kirim", headerJawabanAI: "Jawaban AI:",
    notifikasi: { pesan: "Waktu produksi yang dihitung telah tercapai!" },
    placeholders:{ 
        targetProduksi:"cth: 1500", beratBobbin:"cth: 15", jumlahPotongan:"cth: 10", waktuPengangkatan:"cth: 5",
        tanggalMulai:"", jamMulai:"misal: 08:00",
        berat:"cth: 16", gsm:"otomatis", pisau:"otomatis", speed:"cth: 10.20",
        jumlahRecycle:"cth:60", moisture:"cth:0.93", konsentrasi:"cth:0.16",
        flowAwal:"cth:100", kecepatanAwal:"cth: 10", kecepatanBaru:"cth: 12",
        gsmFormula: "cth: 0.22", kecepatanBeltingFormula: "cth: 10.0", lebarKertasFormula: "cth: 1.30", pulpConcentrationFormula: "cth: 0.17"
    },
    rc_judulKalkulator: "Kalkulator Komposisi Bahan Dinamis",
    rc_lblProductName: "Nama Produk Jadi:", rc_lblBaseRecycleAmount: "Berat Acuan Recycle (kg):", rc_lblTargetRecycleAmount: "Target Produksi Recycle (kg):",
    rc_headerDetailBahan: "Detail Bahan", rc_headerBahanX: "Bahan {X}", rc_lblNamaBahanX: "Nama Bahan {X}:", rc_lblRasioBhnX: "Rasio Bhn {X} (dlm Berat Acuan):",
    rc_lblKebutuhan: "Kebutuhan",
    rc_btnAddCol: "Tambah Kolom Bahan", rc_btnCalcAll: "Hitung Semua",
    rc_headerRingkasan: "Ringkasan untuk Disalin", rc_btnCopySummary: "Salin Ringkasan",
    rc_placeholderNamaBahan: "Nama Bahan", rc_placeholderRasio: "Mis: Rasio", rc_placeholderProdukABC: "Mis: Produk ABC",
    rc_placeholderAcuanRecycle: "Contoh: 18.75", rc_placeholderTargetRecycle: "Contoh: 30",
    rc_summaryNamaProduk: "Nama Produk:", rc_summaryTargetProduksi: "Target Produksi Recycle:", rc_summaryKebutuhanBahan: "Kebutuhan Bahan:",
    rc_summaryTotalEstimasi: "Total Estimasi Berat Bahan Untuk Perset:",
    rc_alertCopied: "Ringkasan telah disalin ke clipboard!", rc_alertCopyFailed: "Gagal menyalin.", rc_alertNoSummary: "Tidak ada hasil untuk disalin."
  },
  en:{ 
    judulHalaman:"Combined Production Calculator",
    tab0_btn:"Production Time", tab1_btn:"Finish Good Lifting Time", tab2_btn:"Water Recycle", tab3_btn:"New Flowrate", tab4_btn:"Headbox Flowrate", tab5_btn:"AI Huabao", tab6_btn:"Recycle Material Calculator",
    judul0:"Production Time Calculation", judul1:"Finish Good Lifting Time Calculation", judul2:"Water Recycle Calculation", judul3:"New Flowrate Calculation", judul4:"Headbox Flowrate Calculation", judul5:"Chat with Huabao Assistant",
    lblTargetProduksi: "Target Output", lblBeratBobbin: "Bobbin Weight (kg)", lblJumlahPotongan: "Cuts/Bobbin", lblWaktuPengangkatan: "Lifting Time/Bobbin (min)", lblTanggalMulai: "Start Date", lblJamMulai: "Start Time",
    btnPengangkatan:"Calculate End Time", hasilPengangkatan:"Production Ends: ", alert:"Please complete all required fields correctly.",
    lblBerat:"Roll Weight (kg)", lblBahan:"Select Material", lblGsm:"GSM", lblPisau:"Cutter", lblSpeed:"Belt Speed (m/sec)",
    btnHitung:"Calculate Lifting Duration", hasilWaktuAngkat:"Lifting Duration: ",
    lblJumlahRecycle: "Recycle Amount (kg)", lblMoisture: "Moisture (fraction)", lblKonsentrasi: "Concentration (fraction)",
    btnAir:"Calculate Water Recycle", hasilAirRecycle:"Required Water: ",
    lblFlowAwal: "Initial flow rate (L/hr)", lblKecepatanAwal: "Initial belt speed (m/sec)", lblKecepatanBaru: "New belt speed (m/sec)",
    btnFlowrate:"Calculate New Flowrate", hasilFlowrate:"Recommended Flow Rate: ",
    btnFormulaZatPadat:"Calculate Headbox Flowrate", hasilFormulaZatPadat:"Headbox Flowrate: ",
    optBahan0:"Select Material", optBahan1:"Bouyan", optBahan2:"BAT", optBahan3:"Highlander",
    optBahanHeadbox0: "Select Material", optBahanHeadboxBouyan: "Bouyan", optBahanHeadboxCustom: "Custom",
    lblBahanHeadbox: "Select Material:", lblGsmFormulaHeadbox: "GSM:", lblKecepatanBeltingFormulaHeadbox: "Belt Speed (m/sec):", lblLebarKertasFormulaHeadbox: "Paper Width (meter):", lblPulpConcentrationFormulaHeadbox: "Pulp Concentration (fraction):",
    btnSendToGroq: "Send", headerJawabanAI: "AI Answer:",
    notifikasi: { pesan: "The calculated production time has been reached!" },
    placeholders:{
        targetProduksi:"e.g.: 1500", beratBobbin:"e.g.: 15", jumlahPotongan:"e.g.: 10", waktuPengangkatan:"e.g.: 5",
        tanggalMulai:"", jamMulai:"e.g.: 08:00",
        berat:"e.g.: 16", gsm:"auto", pisau:"auto", speed:"e.g.: 10.20",
        jumlahRecycle:"e.g.: 60", moisture:"e.g.: 0.93", konsentrasi:"e.g.: 0.16",
        flowAwal:"e.g.: 100", kecepatanAwal:"e.g.: 10", kecepatanBaru:"e.g.: 12",
        gsmFormula: "e.g.: 0.22", kecepatanBeltingFormula: "e.g.: 10.0", lebarKertasFormula: "e.g.: 1.30", pulpConcentrationFormula: "e.g.: 0.17"
    },
    rc_judulKalkulator: "Dynamic Material Composition Calculator",
    rc_lblProductName: "Finished Product Name:", rc_lblBaseRecycleAmount: "Base Recycle Weight (kg):", rc_lblTargetRecycleAmount: "Target Recycle Production (kg):",
    rc_headerDetailBahan: "Material Details", rc_headerBahanX: "Material {X}", rc_lblNamaBahanX: "Material Name {X}:", rc_lblRasioBhnX: "Material Ratio {X} (in Base Weight):",
    rc_lblKebutuhan: "Required", rc_btnAddCol: "Add Material Column", rc_btnCalcAll: "Calculate All",
    rc_headerRingkasan: "Summary to Copy", rc_btnCopySummary: "Copy Summary",
    rc_placeholderNamaBahan: "Material Name", rc_placeholderRasio: "e.g., Ratio", rc_placeholderProdukABC: "e.g., Product ABC",
    rc_placeholderAcuanRecycle: "e.g., 18.75", rc_placeholderTargetRecycle: "e.g., 30",
    rc_summaryNamaProduk: "Product Name:", rc_summaryTargetProduksi: "Target Recycle Production:", rc_summaryKebutuhanBahan: "Material Requirement:",
    rc_summaryTotalEstimasi: "Total Estimated Material Weight for Set:",
    rc_alertCopied: "Summary copied to clipboard!", rc_alertCopyFailed: "Copy failed.", rc_alertNoSummary: "No results to copy."
  },
  zh:{ 
    judulHalaman:"生产计算器合集",
    tab0_btn:"生产时间", tab1_btn:"成品提取时间", tab2_btn:"循环水", tab3_btn:"新流速", tab4_btn:"网前箱流速", tab5_btn:"华宝AI助手", tab6_btn:"回收材料计算器",
    judul0:"生产时间计算", judul1:"成品提取时间计算", judul2:"循环水计算", judul3:"新流速计算", judul4:"计算网前箱流速", judul5:"与华宝AI助手聊天",
    lblTargetProduksi: "目标产量", lblBeratBobbin: "筒重 (公斤)", lblJumlahPotongan: "每筒切割数", lblWaktuPengangkatan: "每筒提升时间 (分钟)", lblTanggalMulai: "开始日期", lblJamMulai: "开始时间",
    btnPengangkatan:"计算结束时间", hasilPengangkatan:"生产结束于：", alert:"请正确填写所有必填信息。",
    lblBerat:"卷重 (公斤)", lblBahan:"选择材料", lblGsm:"克重", lblPisau:"刀具", lblSpeed:"皮带速度 (米/秒)",
    btnHitung:"计算提取时长", hasilWaktuAngkat:"提取时长：",
    lblJumlahRecycle: "循环数量 (公斤)", lblMoisture: "水分 (小数)", lblKonsentrasi: "浓度 (小数)",
    btnAir:"计算循环水量", hasilAirRecycle:"所需水量：",
    lblFlowAwal: "初始流速 (升/小时)", lblKecepatanAwal: "当前皮带速度 (米/秒)", lblKecepatanBaru: "最新皮带速度 (米/秒)",
    btnFlowrate:"计算新流速", hasilFlowrate:"建议流速：",
    btnFormulaZatPadat:"计算网前箱流速", hasilFormulaZatPadat:"网前箱流速：",
    optBahan0:"选择材料", optBahan1:"博彦", optBahan2:"BAT", optBahan3:"汉兰达", 
    optBahanHeadbox0: "选择材料", optBahanHeadboxBouyan: "博彦", optBahanHeadboxCustom: "自定义",
    lblBahanHeadbox: "选择材料:", lblGsmFormulaHeadbox: "克重:", lblKecepatanBeltingFormulaHeadbox: "皮带速度 (米/秒):", lblLebarKertasFormulaHeadbox: "纸张宽度 (米):", lblPulpConcentrationFormulaHeadbox: "纸浆浓度 (小数):",
    btnSendToGroq: "发送", headerJawabanAI: "AI 回答:",
    notifikasi: { pesan: "计算的生产时间已到！" },
    placeholders:{
        targetProduksi:"例如：1500", beratBobbin:"例如：15", jumlahPotongan:"例如：10", waktuPengangkatan:"例如：5",
        tanggalMulai:"", jamMulai:"例如：08:00",
        berat:"例如：16", gsm:"自动", pisau:"自动", speed:"例如：10.20",
        jumlahRecycle:"例如：60", moisture:"例如：0.93", konsentrasi:"例如：0.16",
        flowAwal:"例如：100", kecepatanAwal:"例如：10", kecepatanBaru:"例如：12",
        gsmFormula: "例如: 0.22", kecepatanBeltingFormula: "例如: 10.0", lebarKertasFormula: "例如: 1.30", pulpConcentrationFormula: "例如：0.17"
    },
    rc_judulKalkulator: "动态材料成分计算器",
    rc_lblProductName: "成品名称:", rc_lblBaseRecycleAmount: "回收基准重量 (公斤):", rc_lblTargetRecycleAmount: "目标回收产量 (公斤):",
    rc_headerDetailBahan: "材料详情", rc_headerBahanX: "材料 {X}", rc_lblNamaBahanX: "材料名称 {X}:", rc_lblRasioBhnX: "材料配比 {X} (占基准重量):",
    rc_lblKebutuhan: "需求", rc_btnAddCol: "添加材料列", rc_btnCalcAll: "计算全部",
    rc_headerRingkasan: "复制摘要", rc_btnCopySummary: "复制摘要",
    rc_placeholderNamaBahan: "材料名称", rc_placeholderRasio: "例如: 比率", rc_placeholderProdukABC: "例如: 产品ABC",
    rc_placeholderAcuanRecycle: "例如: 18.75", rc_placeholderTargetRecycle: "例如: 30",
    rc_summaryNamaProduk: "产品名称:", rc_summaryTargetProduksi: "目标回收生产:", rc_summaryKebutuhanBahan: "材料需求:",
    rc_summaryTotalEstimasi: "每套材料总估算重量:",
    rc_alertCopied: "摘要已复制到剪贴板！", rc_alertCopyFailed: "复制失败。", rc_alertNoSummary: "没有可复制的结果。"
  }
};
//=============== END INTERNATIONALIZATION (i18n) OBJECT ===============

//=============== BEGIN JAVASCRIPT FUNCTIONS ===============
let targetWaktuSelesaiNotifikasi = null;
let intervalCekWaktuNotifikasi = null;
let notifikasiSudahDitampilkan = false;

function setText(elementId, textContent) {
    const el = document.getElementById(elementId);
    if (el) {
        el.innerText = textContent !== undefined ? textContent : ""; 
    }
}
function setPlaceholder(elementId, placeholderText) {
    const el = document.getElementById(elementId);
    if (el && (el.tagName === "INPUT" || el.tagName === "TEXTAREA") && !el.readOnly) {
        el.placeholder = placeholderText !== undefined ? placeholderText : "";
    }
}

function ubahBahasa(){
  const lang = document.getElementById("language").value;
  const t = teks[lang];
  if (!t) {
    console.error("Language data not found for:", lang);
    return;
  }

  setText("judulHalaman", t.judulHalaman);
  ["tab0_btn","tab1_btn","tab2_btn","tab3_btn","tab4_btn", "tab5_btn", "tab6_btn"].forEach((id)=>setText(id, t[id]));
  ["judul0","judul1","judul2","judul3","judul4", "judul5", "rc_judulKalkulator"].forEach((id)=>setText(id, t[id])); // Include rc_judulKalkulator

  // Tab 0
  setText("lblTargetProduksi", t.lblTargetProduksi); setPlaceholder("targetProduksi", t.placeholders.targetProduksi);
  setText("lblBeratBobbin", t.lblBeratBobbin); setPlaceholder("beratBobbin", t.placeholders.beratBobbin);
  setText("lblJumlahPotongan", t.lblJumlahPotongan); setPlaceholder("jumlahPotongan", t.placeholders.jumlahPotongan);
  setText("lblWaktuPengangkatan", t.lblWaktuPengangkatan); setPlaceholder("waktuPengangkatan", t.placeholders.waktuPengangkatan);
  setText("lblTanggalMulai", t.lblTanggalMulai); 
  setText("lblJamMulai", t.lblJamMulai); setPlaceholder("jamMulai", t.placeholders.jamMulai);
  setText("btnPengangkatan", t.btnPengangkatan); setText("hasilPengangkatan", t.hasilPengangkatan);

  // Tab 1
  setText("lblBerat", t.lblBerat); setPlaceholder("berat", t.placeholders.berat);
  setText("lblBahan", t.lblBahan); setText("optBahan0", t.optBahan0); setText("optBahan1", t.optBahan1); setText("optBahan2", t.optBahan2); setText("optBahan3", t.optBahan3);
  setText("lblGsm", t.lblGsm); setPlaceholder("gsm", t.placeholders.gsm);
  setText("lblPisau", t.lblPisau); setPlaceholder("pisau", t.placeholders.pisau);
  setText("lblSpeed", t.lblSpeed); setPlaceholder("speed", t.placeholders.speed);
  setText("btnHitung", t.btnHitung); setText("hasilWaktuAngkat", t.hasilWaktuAngkat);

  // Tab 2
  setText("lblJumlahRecycle", t.lblJumlahRecycle); setPlaceholder("jumlahRecycle", t.placeholders.jumlahRecycle);
  setText("lblMoisture", t.lblMoisture); setPlaceholder("moisture", t.placeholders.moisture);
  setText("lblKonsentrasi", t.lblKonsentrasi); setPlaceholder("konsentrasi", t.placeholders.konsentrasi);
  setText("btnAir", t.btnAir); setText("hasilAirRecycle", t.hasilAirRecycle);

  // Tab 3
  setText("lblFlowAwal", t.lblFlowAwal); setPlaceholder("flowAwal", t.placeholders.flowAwal);
  setText("lblKecepatanAwal", t.lblKecepatanAwal); setPlaceholder("kecepatanAwal", t.placeholders.kecepatanAwal);
  setText("lblKecepatanBaru", t.lblKecepatanBaru); setPlaceholder("kecepatanBaru", t.placeholders.kecepatanBaru);
  setText("btnFlowrate", t.btnFlowrate); setText("hasilFlowrate", t.hasilFlowrate);
  
  // Tab 4
  setText("lblBahanHeadbox", t.lblBahanHeadbox); setText("optBahanHeadbox0", t.optBahanHeadbox0); setText("optBahanHeadboxBouyan", t.optBahanHeadboxBouyan); setText("optBahanHeadboxCustom", t.optBahanHeadboxCustom);
  setText("lblGsmFormulaHeadbox", t.lblGsmFormulaHeadbox); setPlaceholder("gsmFormula", t.placeholders.gsmFormula);
  setText("lblKecepatanBeltingFormulaHeadbox", t.lblKecepatanBeltingFormulaHeadbox); setPlaceholder("kecepatanBeltingFormula", t.placeholders.kecepatanBeltingFormula);
  setText("lblLebarKertasFormulaHeadbox", t.lblLebarKertasFormulaHeadbox); setPlaceholder("lebarKertasFormula", t.placeholders.lebarKertasFormula);
  setText("lblPulpConcentrationFormulaHeadbox", t.lblPulpConcentrationFormulaHeadbox); setPlaceholder("pulpConcentrationFormula", t.placeholders.pulpConcentrationFormula);
  setText("btnFormulaZatPadat", t.btnFormulaZatPadat); setText("hasilFormulaZatPadat", t.hasilFormulaZatPadat);

  // Tab 5 (AI)
  setText("btnSendToGroq", t.btnSendToGroq); setText("headerJawabanAI", t.headerJawabanAI);
  const inputTextGroqEl = document.getElementById('inputTextGroq');
  if(inputTextGroqEl) inputTextGroqEl.placeholder = lang === 'id' ? "Tulis pertanyaan Anda di sini..." : lang === 'en' ? "Write your question here..." : "在此处写下您的问题...";

  // Tab 6 (Recycle Calculator - Disederhanakan)
  setText("rc_lblProductName", t.rc_lblProductName); setPlaceholder("rc_productName", t.rc_placeholderProdukABC);
  setText("rc_lblBaseRecycleAmount", t.rc_lblBaseRecycleAmount); setPlaceholder("rc_baseRecycleAmount", t.rc_placeholderAcuanRecycle);
  setText("rc_lblTargetRecycleAmount", t.rc_lblTargetRecycleAmount); setPlaceholder("rc_targetRecycleAmount", t.rc_placeholderTargetRecycle);
  setText("rc_headerDetailBahan", t.rc_headerDetailBahan);
  setText("rc_btnAddCol", t.rc_btnAddCol); setText("rc_btnCalcAll", t.rc_btnCalcAll);
  setText("rc_headerRingkasan", t.rc_headerRingkasan); 
  const rcSummaryEl = document.getElementById('rc_summaryForCopy');
  if (rcSummaryEl) rcSummaryEl.placeholder = lang === 'id' ? "Hasil perhitungan akan muncul di sini..." : lang === 'en' ? "Calculation results will appear here..." : "计算结果将显示在此处...";
  setText("rc_btnCopySummary", t.rc_btnCopySummary);
  
  updateIngredientDisplayNames_Recycle(); 
  calculateAll_Recycle(); 
  loadProductNames_Recycle(); 

  aturGSMdanPisau();
  aturInputHeadbox();
  const popupNotifikasi = document.getElementById("notifikasiSelesaiPopup");
  if (popupNotifikasi && popupNotifikasi.classList.contains("show") && t.notifikasi) {
      setText("teksNotifikasiSelesai", t.notifikasi.pesan);
  }
}

function showTab(index){
  document.querySelectorAll(".tab-container .tab").forEach((tab,i)=>{ 
    tab.classList.toggle("active",i===index);
  });
  document.querySelectorAll(".content").forEach((c,i)=>{
    c.classList.toggle("active",i===index);
  });
 }

function getValue(id, defaultValue = null, isNumeric = true) {
    const element = document.getElementById(id);
    if (!element) {
        return defaultValue;
    }
    let value = element.value;
    if (isNumeric) {
        value = parseFloat(value.replace(',', '.')); 
        return isNaN(value) ? defaultValue : value;
    }
    return value === "" ? defaultValue : value;
}

function hitungWaktuPengangkatan(){ /* Implementasi lengkap dari kode Anda */ }
function aturGSMdanPisau(){ /* Implementasi lengkap dari kode Anda */ }
function hitungWaktuAngkat(){ /* Implementasi lengkap dari kode Anda */ }
function hitungAirRecycle(){ /* Implementasi lengkap dari kode Anda */ }
function hitungFlowrateBaru(){ /* Implementasi lengkap dari kode Anda */ }
function aturInputHeadbox() { /* Implementasi lengkap dari kode Anda */ }
function hitungFormulaHeadbox(){ /* Implementasi lengkap dari kode Anda */ }

function tampilkanNotifikasiProduksiSelesai() {
    const lang = document.getElementById("language").value;
    const t = teks[lang];
    const popup = document.getElementById("notifikasiSelesaiPopup");
    if(popup && t && t.notifikasi) {
        setText("teksNotifikasiSelesai", t.notifikasi.pesan);
        popup.classList.add("show");
    }
    notifikasiSudahDitampilkan = true;
    if (intervalCekWaktuNotifikasi) {
        clearInterval(intervalCekWaktuNotifikasi);
        intervalCekWaktuNotifikasi = null;
    }
}
function tutupNotifikasiSelesai() {
    const popup = document.getElementById("notifikasiSelesaiPopup");
    if (popup) popup.classList.remove("show");
}
function cekWaktuProduksiSelesaiSecaraBerkala() {
    if (!targetWaktuSelesaiNotifikasi || notifikasiSudahDitampilkan) return;
    if (new Date() >= targetWaktuSelesaiNotifikasi) {
        tampilkanNotifikasiProduksiSelesai();
    }
}

async function sendToGroq(userInput = null) { 
  const input = userInput !== null ? userInput : document.getElementById('inputTextGroq').value;
  const responseArea = document.getElementById('responseAreaGroq');
  if(responseArea) responseArea.textContent = 'Sedang memproses...';

  const contextMemory = `Kamu adalah asisten AI bernama Huabao yang ramah, santai, dan suka menjawab dengan bahasa Indonesia nonformal.
Selain membantu dengan perhitungan produksi berdasarkan struktur kalkulator ini, kamu juga memiliki tugas sebagai penerjemah.

Gunakan gaya bahasa seperti ngobrol biasa, gak kaku, dan tetap jelas saat berinteraksi.
Jika pengguna memberikan teks dalam Bahasa Indonesia dan memintamu menerjemahkannya (atau konteksnya jelas adalah permintaan terjemahan), lakukan langkah berikut:
1. Perbaiki dan format ulang teks Bahasa Indonesia tersebut agar lebih formal dan jelas jika diperlukan.
2. Terjemahkan teks Bahasa Indonesia yang sudah diperbaiki tersebut ke dalam Bahasa Mandarin (Simplified Chinese).
3. Sajikan hasil terjemahan Bahasa Mandarin dengan jelas.

Ringkasan Struktur HTML Kalkulator Produksi:
- Tab 0: Hitung Waktu Produksi
- Tab 1: Waktu Angkat Finish Good
- Tab 2: Air Recycle
- Tab 3: Flowrate Baru
- Tab 4: Flowrate Headbox
- Tab 5: AI Huabao (chat umum & terjemahan)
- Tab 6: Kalkulator Bahan Recycle
  - Tujuan: Menghitung kebutuhan bahan untuk produksi recycle.
  - Input Utama: Nama Produk Jadi (dengan fitur autocomplete dari riwayat input lokal dan daftar default), Berat Acuan Recycle (kg), Target Produksi Recycle (kg).
  - Input Per Bahan (Dinamis): Nama Bahan, Rasio Bhn (dlm Berat Acuan).
  - Output: Kebutuhan per bahan (kg), total estimasi berat (kg).
  - (Fitur input teks dari OCR untuk AI telah dihilangkan dari Tab 6).

Instruksi:
Gunakan pemahaman di atas untuk menjawab pertanyaan pengguna berdasarkan struktur kalkulator atau melakukan terjemahan, tergantung input pengguna.`;
  try {
    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer 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' 
      },
      body: JSON.stringify({
        model: "llama3-8b-8192",
        messages: [
          { role: "system", content: contextMemory },
          { role: "user", content: input }
        ]
      })
    });
    if (!res.ok) {
        const errorData = await res.json();
        throw new Error(`API request failed with status ${res.status}: ${errorData.error?.message || 'Unknown error'}`);
    }
    const data = await res.json();
    const reply = data.choices?.[0]?.message?.content || 'Tidak ada respons dari AI.';
    if(responseArea) responseArea.textContent = reply;
    return reply; 
  } catch (error) {
    console.error('Error sending to Groq:', error);
    if(responseArea) responseArea.textContent = 'Terjadi kesalahan: ' + error.message;
    return null; 
  }
}
//=============== END COMBINED CALCULATOR FUNCTIONS (EXISTING) ===============


//=============== BEGIN RECYCLE CALCULATOR FUNCTIONS (Autocomplete fixed, OCR text input REMOVED) ===============
let rc_ingredientCounter = 1; 
const RC_PRODUCT_NAMES_STORAGE_KEY = 'rc_knownProductNames';

function initializeDefaultProductNames_Recycle() {
    console.log("Initializing default product names..."); // DEBUG
    const defaultNames = [
        "PTWCJ-HTBH-5C", "PTWCJ-HTBLM-2(2)", "PTWCJ-HTNY-7", "PTWCJ-HTHH-3C(3)",
        "PTWCJ-HTMJT-3", "PTWCJ-HTBH-6A(2)", "PTWCJ-HTXG-6", "PTWCJ-HTBH-6-1",
        "PTWCJ-HTKY-11", "PTWCJ-HTHH-4", "PTWCJ-HTCH-10", "PTWCJ-HTNM-6",
        "PTWCJ-HTKF-9", "PTWCJ-HTHMG-1", "PTWCJ-HTYW-1", "PTWCJ-HTHHXJ-1",
        "PTWCJ-HTNY-11", "PTWCJ-HTLMJ-1", "PTWCJ-HTBMG-4", "PTWCJ-HTRW",
        "PTWCJ-HTKT", "PTWCJ-HTBML"
    ];

    let knownNames = getKnownProductNames_Recycle(); 
    console.log("Current known names from localStorage:", JSON.parse(JSON.stringify(knownNames))); // DEBUG
    let updated = false;

    defaultNames.forEach(defaultName => {
        const trimmedDefaultName = defaultName.trim();
        if (trimmedDefaultName && !knownNames.includes(trimmedDefaultName)) {
            knownNames.push(trimmedDefaultName);
            updated = true;
        }
    });

    if (updated) {
        try {
            localStorage.setItem(RC_PRODUCT_NAMES_STORAGE_KEY, JSON.stringify(knownNames));
            console.log("Updated localStorage with default product names:", knownNames); // DEBUG
        } catch (e) {
            console.error("Error initializing default product names in localStorage:", e);
        }
    } else {
        console.log("No new default product names to add to localStorage or list already contains them."); // DEBUG
    }
}

function getKnownProductNames_Recycle() {
    const names = localStorage.getItem(RC_PRODUCT_NAMES_STORAGE_KEY);
    try {
        return names ? JSON.parse(names) : [];
    } catch (e) {
        console.error("Error parsing known product names from localStorage:", e);
        localStorage.removeItem(RC_PRODUCT_NAMES_STORAGE_KEY); // Clear corrupted data
        return []; 
    }
}

function saveProductName_Recycle(productName) {
    console.log("Attempting to save product name:", productName); // DEBUG
    if (!productName || typeof productName !== 'string' || productName.trim() === "") {
        return;
    }
    let names = getKnownProductNames_Recycle();
    const trimmedName = productName.trim();
    if (!names.includes(trimmedName)) {
        names.push(trimmedName);
        try {
            localStorage.setItem(RC_PRODUCT_NAMES_STORAGE_KEY, JSON.stringify(names));
            console.log("Saved new product names to localStorage:", names); // DEBUG
        } catch (e) {
            console.error("Error saving product name to localStorage:", e);
        }
        loadProductNames_Recycle(); 
    }
}

function loadProductNames_Recycle() {
    const datalist = document.getElementById('rc_productNameSuggestionsDatalist');
    if (!datalist) {
        console.error("Datalist 'rc_productNameSuggestionsDatalist' not found for loading.");
        return;
    }
    datalist.innerHTML = ''; 
    const names = getKnownProductNames_Recycle();
    console.log("Loading product name suggestions to datalist:", names); // DEBUG
    names.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        datalist.appendChild(option);
    });
}

function addIngredientColumn_Recycle(name = "", ratio = "") { 
    rc_ingredientCounter++;
    const container = document.getElementById('rc_ingredientSectionsContainer');
    if (!container) return;
    const lang = document.getElementById("language").value;
    const t = teks[lang];

    const headerTextDefault = `Bahan ${rc_ingredientCounter}`;
    const headerText = t.rc_headerBahanX ? t.rc_headerBahanX.replace('{X}', rc_ingredientCounter) : headerTextDefault;
    
    const labelNameTextDefault = `Nama Bahan ${rc_ingredientCounter}:`;
    const labelNameText = t.rc_lblNamaBahanX ? t.rc_lblNamaBahanX.replace('{X}', rc_ingredientCounter) : labelNameTextDefault;

    const labelRatioTextDefault = `Rasio Bhn ${rc_ingredientCounter} (dlm Berat Acuan):`;
    const labelRatioText = t.rc_lblRasioBhnX ? t.rc_lblRasioBhnX.replace('{X}', rc_ingredientCounter) : labelRatioTextDefault;
    
    const placeholderNamaBahan = t.rc_placeholderNamaBahan || "Nama Bahan";
    const placeholderRasio = t.rc_placeholderRasio || "Mis: Rasio";
    const labelKebutuhan = t.rc_lblKebutuhan || "Kebutuhan";

    const newIngredientHTML = `
        <div class="rc-input-group" data-ingredient-id="${rc_ingredientCounter}">
            <h3>${name || headerText}</h3>
            <label for="rc_ingredientName${rc_ingredientCounter}">${labelNameText}</label>
            <input type="text" id="rc_ingredientName${rc_ingredientCounter}" class="rc-ingredient-name-input" placeholder="${placeholderNamaBahan}" value="${name}">
            <label for="rc_ingredientRatio${rc_ingredientCounter}">${labelRatioText}</label>
            <input type="number" id="rc_ingredientRatio${rc_ingredientCounter}" class="rc-ingredient-ratio-input" placeholder="${placeholderRasio}" step="any" value="${ratio}">
            <p>${labelKebutuhan} <span class="rc-ingredientNameDisplay" id="rc_ingredientNameDisplay${rc_ingredientCounter}">${name || headerText}</span>: <span class="rc-result-text rc-ingredient-result" id="rc_ingredientResult${rc_ingredientCounter}">0.00</span> kg</p>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', newIngredientHTML);
    attachEventListenersToNewInputs_Recycle(rc_ingredientCounter);
    updateIngredientDisplayNames_Recycle(); 
}

function updateIngredientDisplayNames_Recycle() {
    const lang = document.getElementById("language").value;
    const t = teks[lang];
    document.querySelectorAll('#rc_ingredientSectionsContainer .rc-input-group').forEach(groupEl => {
        const idNum = groupEl.dataset.ingredientId;
        const nameInput = document.getElementById(`rc_ingredientName${idNum}`);
        const displaySpan = document.getElementById(`rc_ingredientNameDisplay${idNum}`);
        
        const headerH3 = groupEl.querySelector('h3');
        const labelName = groupEl.querySelector(`label[for="rc_ingredientName${idNum}"]`);
        const labelRatio = groupEl.querySelector(`label[for="rc_ingredientRatio${idNum}"]`);
        const kebutuhanP_first_child = groupEl.querySelector('p')?.childNodes[0]; 

        const defaultBahanText = t.rc_headerBahanX ? t.rc_headerBahanX.replace('{X}', idNum) : `Bahan ${idNum}`;
        const currentNameVal = nameInput ? nameInput.value : "";

        const dynamicName = currentNameVal || defaultBahanText;
        if (headerH3) headerH3.textContent = dynamicName;
        if (displaySpan) displaySpan.textContent = dynamicName;
        
        if (labelName && t.rc_lblNamaBahanX) labelName.textContent = t.rc_lblNamaBahanX.replace('{X}', idNum);
        if (labelRatio && t.rc_lblRasioBhnX) labelRatio.textContent = t.rc_lblRasioBhnX.replace('{X}', idNum);
        if (kebutuhanP_first_child && t.rc_lblKebutuhan) kebutuhanP_first_child.nodeValue = t.rc_lblKebutuhan + " ";
        
        if(nameInput) setPlaceholder(nameInput.id, t.rc_placeholderNamaBahan || "Nama Bahan");
        const ratioInputEl = document.getElementById(`rc_ingredientRatio${idNum}`);
        if (ratioInputEl) setPlaceholder(ratioInputEl.id, t.rc_placeholderRasio || "Mis: Rasio");
    });
}

function attachEventListenersToAllInputs_Recycle() {
    const rcOverallInputs = document.querySelectorAll('#tab-6 .rc-overall-inputs input[type="text"], #tab-6 .rc-overall-inputs input[type="number"]');
    rcOverallInputs.forEach(input => {
        if(input.id !== 'rc_productName') { 
             input.addEventListener('input', calculateAll_Recycle);
        }
    });
    const productNameInput = document.getElementById('rc_productName');
    if (productNameInput) {
        productNameInput.addEventListener('blur', function() { 
            saveProductName_Recycle(this.value); 
            // calculateAll_Recycle(); // Perhitungan dipicu oleh input event saja untuk konsistensi
        });
         productNameInput.addEventListener('input', calculateAll_Recycle); 
    }
    if (document.getElementById(`rc_ingredientName1`)) { // Cek jika elemen default ada
        attachEventListenersToNewInputs_Recycle(1); 
    }
}

function attachEventListenersToNewInputs_Recycle(idNum) {
    const nameInput = document.getElementById(`rc_ingredientName${idNum}`);
    if (nameInput) {
        nameInput.addEventListener('input', () => {
            updateIngredientDisplayNames_Recycle();
            calculateAll_Recycle();
        });
    }
    const ratioInput = document.getElementById(`rc_ingredientRatio${idNum}`);
    if (ratioInput) {
        ratioInput.addEventListener('input', calculateAll_Recycle);
    }
}

function calculateAll_Recycle() { 
    const lang = document.getElementById("language").value;
    const t = teks[lang];

    const productName = getValue("rc_productName", (t.rc_placeholderProdukABC ? t.rc_placeholderProdukABC.replace("Mis: ", "") : "Produk Tanpa Nama"), false);
    const baseRecycle = getValue("rc_baseRecycleAmount", 0);
    const targetRecycle = getValue("rc_targetRecycleAmount", 0);

    let summaryText = `${t.rc_summaryNamaProduk || "Nama Produk:"} ${productName}\n${t.rc_summaryTargetProduksi || "Target Produksi Recycle:"} ${targetRecycle.toFixed(2)} kg\n---\n${t.rc_summaryKebutuhanBahan || "Kebutuhan Bahan:"}\n`;
    let totalCalculatedWeight = 0;

    const ingredientGroups = document.querySelectorAll('#rc_ingredientSectionsContainer .rc-input-group');
    ingredientGroups.forEach(group => {
        const id = group.dataset.ingredientId;
        const defaultBahanText = t.rc_headerBahanX ? t.rc_headerBahanX.replace('{X}', id) : `Bahan ${id}`;
        const name = getValue(`rc_ingredientName${id}`, defaultBahanText, false);
        const ratio = getValue(`rc_ingredientRatio${id}`, 0);
        const resultDisplay = document.getElementById(`rc_ingredientResult${id}`);
        
        let result = 0;
        if (baseRecycle > 0) {
            result = ((ratio / baseRecycle) * targetRecycle); 
        }
        
        if(resultDisplay) resultDisplay.textContent = result.toFixed(2);
        summaryText += `${name}: ${result.toFixed(2)} kg\n`;
        totalCalculatedWeight += result;
    });
    
    summaryText += `---\n${t.rc_summaryTotalEstimasi || "Total Estimasi Berat Bahan Untuk Perset:"} ${totalCalculatedWeight.toFixed(2)} kg`;
    const summaryCopyEl = document.getElementById("rc_summaryForCopy");
    if (summaryCopyEl) summaryCopyEl.value = summaryText;
}
        
function copySummary_Recycle() {
    const lang = document.getElementById("language").value;
    const t = teks[lang];
    const summaryTextarea = document.getElementById("rc_summaryForCopy");
    if (!summaryTextarea || summaryTextarea.value.trim() === "" || !summaryTextarea.value.includes(':')) {
        alert(t.rc_alertNoSummary || "Tidak ada hasil untuk disalin.");
        return;
    }
    summaryTextarea.select();
    summaryTextarea.setSelectionRange(0, 99999);
    try {
        document.execCommand("copy");
        alert(t.rc_alertCopied || "Ringkasan telah disalin!");
    } catch (err) {
        alert((t.rc_alertCopyFailed || "Gagal menyalin.") + " " + err.message);
    }
}
//=============== END RECYCLE CALCULATOR FUNCTIONS ===============

window.onload = function() {
    const tanggalMulaiEl = document.getElementById('tanggalMulai');
    if(tanggalMulaiEl && !tanggalMulaiEl.value) {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        tanggalMulaiEl.value = `${year}-${month}-${day}`;
    }
    
    initializeDefaultProductNames_Recycle(); 
    attachEventListenersToAllInputs_Recycle();
    ubahBahasa(); 
    tutupNotifikasiSelesai();
};
</script>
</body>
</html>
