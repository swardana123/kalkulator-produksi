<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Produksi Lengkap dengan AI</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(to bottom right, #e3f2fd, #ffffff); margin:0; padding:10px; color:#333; }
    .header {
        display:flex;
        flex-direction:column;
        gap:10px;
        align-items:center;
        margin-bottom:20px;
        background-color: #ffffff; /* Latar belakang header menjadi putih polos */
    }
    .header img { max-width: 100px; height: auto; margin-bottom: 5px; }
    .header h1 { font-size:1.5rem; text-align:center; margin-top: 0; margin-bottom: 5px; }
    select { padding:8px; font-size:1rem; border-radius:6px; border:1px solid #ccc; }
    .tab-container { display:flex; flex-wrap: wrap; margin-bottom:10px; border-radius:8px; overflow:hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .tab { flex:1; min-width: 150px; padding:10px; background-color:#eee; text-align:center; cursor:pointer; transition:background-color .3s; font-size:.90rem; border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;}
    .tab:last-child { border-right: none; }
    .tab.active { background-color:#2196F3; color:white; font-weight:bold; border-bottom-color: #2196F3; }
    .content { display:none; background:white; padding:15px; border-radius:0 0 8px 8px; box-shadow:0 2px 10px rgba(0,0,0,.1); animation: fadeIn 0.5s; margin-top:-1px; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .content.active { display:block; }
    input, select, button, textarea { width:100%; max-width:400px; padding:10px; margin:8px 0; font-size:1rem; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; }
    label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9rem; color: #555;}
    button { background-color:#2196F3; color:white; border:none; cursor:pointer; transition: background-color 0.3s; }
    button:hover { background-color:#1976D2; }
    .hasil { margin-top:10px; padding: 10px; background-color: #e8f5e9; border-left: 5px solid #4CAF50; font-weight:bold; color:#2E7D32; border-radius: 4px; }
    .hidden { display:none !important; }
    input[readonly] {
        background-color: #e9ecef;
        color: #495057;
        cursor: not-allowed;
    }
    h2 { margin-top: 0; color: #1976D2; }

    /* Notifikasi Popup */
    .notifikasi-popup {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        background-color: #4CAF50;
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: opacity 0.5s, transform 0.5s;
        opacity: 0;
        transform: translateY(100px);
        pointer-events: none;
    }
    .notifikasi-popup.show {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }
    .notifikasi-popup button {
        background-color: white;
        color: #4CAF50;
        border: 1px solid #4CAF50;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        max-width: 100px;
        margin: 0;
        width: auto;
    }

    /* Gaya untuk Tab Tanya AI */
    #tab-5 textarea {
        min-height: 100px;
    }
    #hasilTanyaAI {
        white-space: pre-wrap; /* Agar spasi dan baris baru dipertahankan */
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSPx-6VZHoYrLUtrsSA2ih9SEeDIqqc2tMeK766Vw2eBKap-ajfgU05Biw&s=10" alt="Calculator Logo">
    <select id="language" onchange="ubahBahasa()">
      <option value="id">Bahasa Indonesia</option>
      <option value="en">English</option>
      <option value="zh">中文 (Mandarin)</option>
    </select>
    <h1 id="judulHalaman">Gabungan Kalkulator Produksi</h1>
  </div>

  <div class="tab-container">
    <div class="tab active" onclick="showTab(0)" id="tab0">Hitung Waktu Produksi</div>
    <div class="tab" onclick="showTab(1)" id="tab1">Waktu Angkat Finish Good</div>
    <div class="tab" onclick="showTab(2)" id="tab2">Air Recycle</div>
    <div class="tab" onclick="showTab(3)" id="tab3">Flowrate Baru</div>
    <div class="tab" onclick="showTab(4)" id="tab4">Flowrate Headbox</div>
    <div class="tab" onclick="showTab(5)" id="tab5">Tanya AI</div>
  </div>

  <div id="tab-0" class="content active">
    <h2 id="judul0">Hitung Waktu Produksi</h2>
    <input id="targetProduksi" type="number" placeholder="Target Produksi (cth: 1500)"/>
    <input id="beratBobbin" type="number" placeholder="Berat Bobbin (kg, cth: 15)"/>
    <input id="jumlahPotongan" type="number" placeholder="Potongan/Bobbin (cth: 10)"/>
    <input id="waktuPengangkatan" type="number" placeholder="Waktu Angkat/Bobbin (menit)"/>
    <input id="tanggalMulai" type="date" />
    <input id="jamMulai" type="time" placeholder="Jam Mulai (misal: 08:00)"/>
    <button onclick="hitungWaktuPengangkatan()" id="btnPengangkatan">Hitung Waktu Selesai</button>
    <div class="hasil" id="hasilPengangkatan">Waktu Selesai Produksi: </div>
  </div>

  <div id="tab-1" class="content">
    <h2 id="judul1">Perhitungan Waktu Angkat Finish Good</h2>
    <input id="berat" type="number" placeholder="Berat Roll (kg), cth: 16"/>
    <select id="bahan" onchange="aturGSMdanPisau()">
      <option id="optBahan0" value="">Pilih Bahan</option>
      <option id="optBahan1" value="Bouyan">Bouyan</option>
      <option id="optBahan2" value="BAT">BAT</option>
      <option id="optBahan3" value="Highlander">Highlander</option>
    </select>
    <input class="hidden" id="gsm" type="number" readonly placeholder="GSM (otomatis)"/>
    <input class="hidden" id="pisau" type="number" readonly placeholder="Pisau (otomatis)"/>
    <input id="speed" type="number" placeholder="Kecepatan Belting (m/detik, cth: 10.20)"/>
    <button onclick="hitungWaktuAngkat()" id="btnHitung">Hitung Durasi Angkat</button>
    <div class="hasil" id="hasilWaktuAngkat">Durasi Angkat: </div>
  </div>

  <div id="tab-2" class="content">
    <h2 id="judul2">Perhitungan Air Recycle</h2>
    <input id="jumlahRecycle" type="number" placeholder="Jumlah Recycle (kg, cth:60)"/>
    <input id="moisture" type="number" step="any" placeholder="Moisture (fraksi, cth:0.93)"/>
    <input id="konsentrasi" type="number" step="any" placeholder="Konsentrasi (fraksi, cth:0.16)"/>
    <button onclick="hitungAirRecycle()" id="btnAir">Hitung Air Recycle</button>
    <div class="hasil" id="hasilAirRecycle">Jumlah Air yang Diperlukan: </div>
  </div>

  <div id="tab-3" class="content">
    <h2 id="judul3">Flowrate Baru</h2>
    <input id="flowAwal" type="number" step="any" placeholder="Flow rate awal (L/jam, cth:100)"/>
    <input id="kecepatanAwal" type="number" step="any" placeholder="Kecepatan belting awal (m/detik)"/>
    <input id="kecepatanBaru" type="number" step="any" placeholder="Kecepatan belting baru (m/detik)"/>
    <button onclick="hitungFlowrateBaru()" id="btnFlowrate">Hitung Flowrate Baru</button>
    <div class="hasil" id="hasilFlowrate">Laju Aliran Disarankan: </div>
  </div>

  <div id="tab-4" class="content">
    <h2 id="judul4">Mencari Flow rate Headbox</h2>
    <label for="bahanHeadbox" id="lblBahanHeadbox">Pilih Material:</label>
    <select id="bahanHeadbox" onchange="aturInputHeadbox()">
      <option id="optBahanHeadbox0" value="">Pilih Material</option>
      <option id="optBahanHeadboxBouyan" value="Bouyan">Bouyan</option>
      <option id="optBahanHeadboxCustom" value="Custom">Custom</option>
    </select>

    <label for="gsmFormula" id="lblGsmFormulaHeadbox">GSM:</label>
    <input id="gsmFormula" type="number" step="any" placeholder="Input GSM (cth: 0.22)"/>

    <label for="kecepatanBeltingFormula" id="lblKecepatanBeltingFormulaHeadbox">Kecepatan Belting (m/detik):</label>
    <input id="kecepatanBeltingFormula" type="number" step="any" placeholder="Input Kecepatan (cth: 10.0)"/>

    <label for="lebarKertasFormula" id="lblLebarKertasFormulaHeadbox">Lebar Kertas (meter):</label>
    <input id="lebarKertasFormula" type="number" step="any" placeholder="Input Lebar (cth: 1.30)"/>

    <label for="pulpConcentrationFormula" id="lblPulpConcentrationFormulaHeadbox">Konsentrasi Pulp (fraksi):</label>
    <input id="pulpConcentrationFormula" type="number" step="any" placeholder="cth: 0.17"/>

    <button onclick="hitungFormulaHeadbox()" id="btnFormulaZatPadat">Hitung Flowrate Headbox</button>
    <div class="hasil" id="hasilFormulaZatPadat">Flowrate Headbox: </div>
  </div>

  <div id="tab-5" class="content">
    <h2 id="judul5">Tanya AI</h2>
    <textarea id="pertanyaanAI" placeholder="Masukkan pertanyaan Anda tentang produksi..."></textarea>
    <button onclick="tanyaAI()" id="btnTanyaAI">Tanya AI</button>
    <div class="hasil" id="hasilTanyaAI">Jawaban AI: </div>
  </div>

  <div id="notifikasiSelesaiPopup" class="notifikasi-popup">
    <span id="teksNotifikasiSelesai"></span>
    <button id="btnTutupNotifikasi" onclick="tutupNotifikasiSelesai()">Tutup</button>
  </div>

<script>
// Variabel global untuk notifikasi
let targetWaktuSelesaiNotifikasi = null;
let intervalCekWaktuNotifikasi = null;
let notifikasiSudahDitampilkan = false;

// **PERHATIAN: API KEY TERLIHAT DI SINI! JANGAN GUNAKAN UNTUK APLIKASI PUBLIK!**
const groqApiKey = 'Gsk_GOdbyLKY4Hrq0HIdOuTXWGdyb3FYFg2S6eSWFMa7GiPsENQDgyuA';

const teks = {
  id:{
    judulHalaman:"Gabungan Kalkulator Produksi",
    tab0:"Hitung Waktu Produksi",tab1:"Waktu Angkat Finish Good",tab2:"Air Recycle",tab3:"Flowrate Baru", tab4:"Flowrate Headbox", tab5:"Tanya AI",
    judul0:"Hitung Waktu Produksi",judul1:"Perhitungan Waktu Angkat Finish Good",judul2:"Perhitungan Air Recycle",judul3:"Flowrate Baru", judul4:"Mencari Flow rate Headbox", judul5:"Tanya AI",
    btnPengangkatan:"Hitung Waktu Selesai",hasilPengangkatan:"Waktu Selesai Produksi: ",alert:"Mohon lengkapi semua data yang diperlukan dengan benar.",
    btnHitung:"Hitung Durasi Angkat",hasilWaktuAngkat:"Durasi Angkat: ",
    btnAir:"Hitung Air Recycle",hasilAirRecycle:"Jumlah Air yang Diperlukan: ",
    btnFlowrate:"Hitung Flowrate Baru",hasilFlowrate:"Laju Aliran Disarankan: ",
    btnFormulaZatPadat:"Hitung Flowrate Headbox", hasilFormulaZatPadat:"Flowrate Headbox: ",
    btnTanyaAI:"Tanya AI", hasilTanyaAI:"Jawaban AI: ",
    optBahan0:"Pilih Bahan",
    optBahanHeadbox0: "Pilih Material",
    optBahanHeadboxBouyan: "Bouyan",
    optBahanHeadboxCustom: "Kustom",
    lblBahanHeadbox: "Pilih Material:",
    lblGsmFormulaHeadbox: "GSM:",
    lblKecepatanBeltingFormulaHeadbox: "Kecepatan Belting (m/detik):",
    lblLebarKertasFormulaHeadbox: "Lebar Kertas (meter):",
    lblPulpConcentrationFormulaHeadbox: "Konsentrasi Pulp (fraksi):",
    notifikasi: {
        pesan: "Waktu produksi yang dihitung telah tercapai!",
        tutupButton: "Tutup"
    },
    placeholders:{
      targetProduksi:"Target Produksi (cth: 1500)",beratBobbin:"Berat Bobbin (kg, cth: 15)",
      jumlahPotongan:"Potongan/Bobbin (cth: 10)",waktuPengangkatan:"Waktu Angkat/Bobbin (menit)",
      tanggalMulai:"Tanggal Mulai",jamMulai:"Jam Mulai (misal: 08:00)",
      berat:"Berat Roll (kg), cth: 16",
      gsm:"GSM (otomatis)", // Placeholder untuk GSM
      pisau:"Pisau (otomatis)", // Placeholder untuk Pisau
      speed:"Kecepatan Belting (m/
